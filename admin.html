<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>پنل مدیریت - کار اول</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      direction: rtl;
    }
    
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .admin-header {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      text-align: center;
    }
    
    .admin-header h1 {
      color: #333;
      margin-bottom: 10px;
    }
    
    .admin-header p {
      color: #666;
    }
    
    .admin-sections {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    .section-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    
    .section-title {
      color: #333;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: bold;
      border-bottom: 2px solid #667eea;
      padding-bottom: 10px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s ease;
      background: #f8f9fa;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      background: white;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }
    
    .checkbox-group {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }
    
    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .checkbox-item input[type="checkbox"] {
      width: auto;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-right: 10px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      background: #5a6fd8;
    }
    
    .btn-success {
      background: #27ae60;
      color: white;
    }
    
    .btn-success:hover {
      background: #229954;
    }
    
    .btn-warning {
      background: #f39c12;
      color: white;
    }
    
    .btn-warning:hover {
      background: #e67e22;
    }
    
    .btn-danger {
      background: #e74c3c;
      color: white;
    }
    
    .btn-danger:hover {
      background: #c0392b;
    }
    
    .products-table {
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: 30px;
    }
    
    .table-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
    }
    
    .table-header h2 {
      margin: 0;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 15px;
      text-align: right;
      border-bottom: 1px solid #eee;
    }
    
    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #333;
    }
    
    tr:hover {
      background: #f8f9fa;
    }
    
    .product-image {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
    }
    
    .badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
      color: white;
      margin: 2px;
      display: inline-block;
    }
    
    .badge.discount {
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
    }
    
    .badge.new {
      background: linear-gradient(45deg, #2ed573, #1e90ff);
    }
    
    .badge.popular {
      background: linear-gradient(45deg, #ffa502, #ff6348);
    }
    
    .stock-status {
      padding: 4px 8px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .stock-status.in-stock {
      background: #d4edda;
      color: #155724;
    }
    
    .stock-status.out-of-stock {
      background: #f8d7da;
      color: #721c24;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .stat-number {
      font-size: 32px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .stat-label {
      color: #666;
      font-size: 14px;
    }
    
    .stat-trend {
      font-size: 12px;
      font-weight: 600;
      margin-top: 5px;
      padding: 2px 8px;
      border-radius: 12px;
      display: inline-block;
    }
    
    .stat-trend.positive {
      background: #d4edda;
      color: #155724;
    }
    
    .stat-trend.negative {
      background: #f8d7da;
      color: #721c24;
    }
    
    .stat-trend.warning {
      background: #fff3cd;
      color: #856404;
    }
    
    .stat-trend.neutral {
      background: #e2e3e5;
      color: #383d41;
    }
    
    /* استایل‌های بخش‌های پیشرفته */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .analytics-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #667eea;
    }
    
    .analytics-card h4 {
      margin-bottom: 15px;
      color: #333;
    }
    
    .chart-container {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    
    .backup-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .backup-action {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    
    .backup-action h4 {
      margin-bottom: 10px;
      color: #333;
    }
    
    .backup-action p {
      color: #666;
      margin-bottom: 15px;
      font-size: 14px;
    }
    
    .ai-settings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .ai-feature {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #27ae60;
    }
    
    .ai-feature h4 {
      margin-bottom: 15px;
      color: #333;
    }
    
    .security-settings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .security-feature {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #e74c3c;
    }
    
    .security-feature h4 {
      margin-bottom: 15px;
      color: #333;
    }
    
    .advanced-settings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .setting-group {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid #f39c12;
    }
    
    .setting-group h4 {
      margin-bottom: 15px;
      color: #333;
    }
    
    #activity-log {
      max-height: 200px;
      overflow-y: auto;
      background: white;
      padding: 15px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
    }
    
    .activity-item {
      padding: 5px 0;
      border-bottom: 1px solid #eee;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-time {
      color: #666;
      font-size: 10px;
    }
    
    .activity-action {
      color: #333;
      font-weight: 600;
    }
    
    .activity-user {
      color: #667eea;
    }
    
    /* استایل نمایش وضعیت سبد خرید */
    .cart-status-info {
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 0.85rem;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 3px 0;
    }

    .status-label {
      color: #666;
      font-size: 0.8rem;
    }

    .status-value {
      font-weight: bold;
      color: #333;
    }

    .status-badge {
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: bold;
    }

    @media (max-width: 768px) {
      .admin-sections {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .table-container {
        font-size: 12px;
      }
      
      th, td {
        padding: 8px;
      }

      .cart-status-info {
        font-size: 0.75rem;
      }
    }

    /* استایل‌های جدید برای قابلیت‌های خفن */
    .notification-center {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 350px;
      max-height: 400px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 1000;
      overflow-y: auto;
      display: none;
    }
    
    .notification-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 15px 15px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .notification-item {
      padding: 15px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .notification-item:hover {
      background: #f8f9fa;
    }
    
    .notification-item.unread {
      background: #e3f2fd;
      border-right: 4px solid #2196f3;
    }
    
    .notification-time {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    .bulk-actions {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: none;
    }
    
    .bulk-actions.active {
      display: block;
    }
    
    .bulk-checkbox {
      margin-right: 10px;
    }
    
    .advanced-search {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .search-filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .performance-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .metric-card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      border-left: 4px solid #667eea;
    }
    
    .metric-value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }
    
    .metric-label {
      font-size: 12px;
      color: #666;
    }
    
    .forecast-chart {
      height: 300px;
      background: #f8f9fa;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-size: 18px;
    }
    
    .inventory-alert {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .security-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    
    .security-card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border-left: 4px solid #e74c3c;
    }
    
    .user-management {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .user-card {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 1px solid #eee;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      margin-left: 15px;
    }
    
    .user-info {
      flex: 1;
    }
    
    .user-actions {
      display: flex;
      gap: 10px;
    }
    
    .import-export {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .file-upload {
      border: 2px dashed #ddd;
      border-radius: 10px;
      padding: 30px;
      text-align: center;
      margin-bottom: 15px;
      cursor: pointer;
      transition: border-color 0.3s ease;
    }
    
    .file-upload:hover {
      border-color: #667eea;
    }
    
    .file-upload.dragover {
      border-color: #667eea;
      background: #f8f9fa;
    }

    /* استایل‌های جدید برای تنظیمات پیشرفته و اعلان‌ها */
    .advanced-settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .setting-panel {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border-left: 4px solid #667eea;
    }
    
    .notification-system {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .notification-types {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .notification-type {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .notification-type:hover {
      border-color: #667eea;
      background: #e3f2fd;
    }
    
    .notification-type.active {
      border-color: #667eea;
      background: #e3f2fd;
    }
    
    .user-selector {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      background: #f8f9fa;
    }
    
    .user-item {
      display: flex;
      align-items: center;
      padding: 8px;
      border-radius: 5px;
      margin-bottom: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .user-item:hover {
      background: #e3f2fd;
    }
    
    .user-item.selected {
      background: #667eea;
      color: white;
    }
    
    .user-item input[type="checkbox"] {
      margin-left: 10px;
    }
    
    .message-preview {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      border: 1px solid #ddd;
    }
    
    .site-settings {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    
    .site-panel {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      border-left: 4px solid #27ae60;
    }
    
    .performance-monitor {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .performance-metric {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    
    .metric-bar {
      height: 8px;
      background: #ddd;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 5px;
    }
    
    .metric-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      transition: width 0.3s ease;
    }
    
    .automation-rules {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .rule-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      border-left: 4px solid #f39c12;
    }
    
    .rule-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .rule-status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .rule-status.active {
      background: #d4edda;
      color: #155724;
    }
    
    .rule-status.inactive {
      background: #f8d7da;
      color: #721c24;
    }
    
    .customization-panel {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .color-picker {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .color-option {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s ease;
    }
    
    .color-option:hover {
      transform: scale(1.1);
    }
    
    .color-option.selected {
      border-color: #333;
    }
    
    .font-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .font-option {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .font-option:hover {
      border-color: #667eea;
      background: #f8f9fa;
    }
    
    .font-option.selected {
      border-color: #667eea;
      background: #e3f2fd;
    }
    
    .integration-panel {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .integration-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    
    .integration-status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }
    
    .integration-status.connected {
      background: #d4edda;
      color: #155724;
    }
    
    .integration-status.disconnected {
      background: #f8d7da;
      color: #721c24;
    }
    
    .integration-status.pending {
      background: #fff3cd;
      color: #856404;
    }
    
    .notification-history {
      max-height: 300px;
      overflow-y: auto;
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
    }
    
    .history-item {
      background: white;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid #667eea;
    }
    
    .history-time {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .history-message {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .history-recipients {
      font-size: 12px;
      color: #999;
    }
    
    .scheduled-notifications {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .schedule-item {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      border-left: 4px solid #e74c3c;
    }
    
    .schedule-time {
      font-weight: 600;
      color: #e74c3c;
      margin-bottom: 5px;
    }
    
    .schedule-message {
      margin-bottom: 10px;
    }
    
    .schedule-recipients {
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body onload="adminAuthPrompt()">
<script>
function adminAuthPrompt() {
  // اگر کاربر وارد نشده یا ادمین نیست، رمز بخواهد
  const adminPassword = localStorage.getItem('adminPassword') || 'mohammadamin';
  let entered = false;
  while (!entered) {
    const pass = prompt('لطفا رمز عبور پنل مدیریت را وارد کنید:');
    if (pass === adminPassword) {
      entered = true;
    } else {
      alert('رمز اشتباه است!');
    }
  }
}
</script>
  <!-- مرکز اعلان‌ها -->
  <div class="notification-center" id="notification-center">
    <div class="notification-header">
      <h3>🔔 اعلان‌ها</h3>
      <button onclick="toggleNotifications()" style="background: none; border: none; color: white; font-size: 20px;">×</button>
    </div>
    <div id="notification-list">
      <!-- اعلان‌ها اینجا نمایش داده می‌شوند -->
    </div>
  </div>

  <div class="admin-container">
    <div class="admin-header">
      <h1>🚀 پنل مدیریت پیشرفته کار آوال</h1>
      <p>مدیریت کامل فروشگاه با قابلیت‌های پیشرفته و هوشمند</p>
      <div style="margin-top: 15px;">
        <button class="btn btn-success" onclick="addSampleProducts()">➕ افزودن محصولات نمونه</button>
        <button class="btn btn-primary" onclick="refreshData()">🔄 بروزرسانی داده‌ها</button>
        <button class="btn btn-warning" onclick="showAnalytics()">📊 تحلیل‌های پیشرفته</button>
        <button class="btn btn-danger" onclick="showBackupManager()">💾 مدیریت پشتیبان</button>
        <button class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" onclick="showAISettings()">🤖 تنظیمات هوشمند</button>
        <button class="btn" style="background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white;" onclick="toggleNotifications()">🔔 اعلان‌ها</button>
        <button class="btn" style="background: linear-gradient(135deg, #2ed573, #1e90ff); color: white;" onclick="showAdvancedFeatures()">🚀 قابلیت‌های پیشرفته</button>
        <button class="btn" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white;" onclick="showUserNotifications()">📢 اعلان‌های کاربران</button>
        <button class="btn" style="background: linear-gradient(135deg, #34495e, #2c3e50); color: white;" onclick="showAdvancedSettings()">⚙️ تنظیمات پیشرفته</button>
      </div>
    </div>

    <!-- آمار پیشرفته -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="totalProducts">0</div>
        <div class="stat-label">📦 کل محصولات</div>
        <div class="stat-trend" id="productsTrend">↗️ +12%</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="totalOrders">0</div>
        <div class="stat-label">🛒 کل سفارشات</div>
        <div class="stat-trend" id="ordersTrend">↗️ +8%</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="totalRevenue">0</div>
        <div class="stat-label">💰 درآمد کل (تومان)</div>
        <div class="stat-trend" id="revenueTrend">↗️ +15%</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="lowStock">0</div>
        <div class="stat-label">⚠️ محصولات کم‌موجود</div>
        <div class="stat-trend" id="stockTrend">🔴 نیاز به بررسی</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="activeUsers">0</div>
        <div class="stat-label">👥 کاربران فعال</div>
        <div class="stat-trend" id="usersTrend">↗️ +5%</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="avgRating">0.0</div>
        <div class="stat-label">⭐ میانگین امتیاز</div>
        <div class="stat-trend" id="ratingTrend">↗️ +0.2</div>
      </div>
    </div>

    <div class="admin-sections">
      <!-- مدیریت منوها -->
      <div class="section-card">
        <h3 class="section-title">مدیریت منوها و صفحات</h3>
        <div class="form-group">
          <label>تنظیمات منوی اصلی:</label>
          <div style="margin-top: 10px;">
            <div class="checkbox-item">
              <input type="checkbox" id="menu-all-products" checked>
              <label for="menu-all-products">نمایش "تمام‌محصولات"</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="menu-hats" checked>
              <label for="menu-hats">نمایش "کلاه"</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="menu-shorts" checked>
              <label for="menu-shorts">نمایش "شلوارک"</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="menu-pants" checked>
              <label for="menu-pants">نمایش "شلوار"</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="menu-tshirts" checked>
              <label for="menu-tshirts">نمایش "تیشرت"</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="menu-trust" checked>
              <label for="menu-trust">نمایش "اعتماد"</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="menu-badges" checked>
              <label for="menu-badges">نمایش "نشان‌ها"</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="menu-contact" checked>
              <label for="menu-contact">نمایش "تماس‌باما"</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="menu-admin" checked>
              <label for="menu-admin">نمایش "ادمین"</label>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label>تنظیمات صفحات:</label>
          <div style="margin-top: 10px;">
            <div class="checkbox-item">
              <input type="checkbox" id="page-contact" checked>
              <label for="page-contact">فعال بودن صفحه تماس</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="page-badges" checked>
              <label for="page-badges">فعال بودن صفحه نشان‌ها</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="page-about" checked>
              <label for="page-about">فعال بودن صفحه درباره ما</label>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label>تنظیمات دسته‌بندی‌ها:</label>
          <div style="margin-top: 10px;">
            <div class="checkbox-item">
              <input type="checkbox" id="cat-hats" checked>
              <label for="cat-hats">دسته‌بندی "کلاه" فعال</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="cat-shorts" checked>
              <label for="cat-shorts">دسته‌بندی "شلوارک" فعال</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="cat-pants" checked>
              <label for="cat-pants">دسته‌بندی "شلوار" فعال</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="cat-tshirts" checked>
              <label for="cat-tshirts">دسته‌بندی "تیشرت" فعال</label>
            </div>
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="saveMenuSettings()">ذخیره تنظیمات منو</button>
        <button class="btn btn-warning" onclick="resetMenuSettings()">بازنشانی تنظیمات</button>
      </div>
      
      <!-- فرم افزودن محصول -->
      <div class="section-card">
        <h3 class="section-title">افزودن محصول جدید</h3>
        <form id="product-form">
          <div class="form-group">
            <label for="product-name">نام محصول *</label>
            <input type="text" id="product-name" required />
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="product-price">قیمت (تومان) *</label>
              <input type="number" id="product-price" required min="0" />
            </div>
            <div class="form-group">
              <label for="product-discount">تخفیف (%)</label>
              <input type="number" id="product-discount" min="0" max="100" value="0" />
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="product-stock">موجودی *</label>
              <input type="number" id="product-stock" required min="0" value="10" />
            </div>
            <div class="form-group">
              <label for="product-rating">امتیاز (1-5)</label>
              <input type="number" id="product-rating" min="0" max="5" step="0.1" value="0" />
            </div>
          </div>
          
          <div class="form-group">
            <label for="product-category">دسته‌بندی</label>
            <select id="product-category">
              <option value="الکترونیک">الکترونیک</option>
              <option value="پوشاک">پوشاک</option>
              <option value="کتاب">کتاب</option>
              <option value="ورزشی">ورزشی</option>
              <option value="خانگی">خانگی</option>
              <option value="عمومی">عمومی</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="product-image">آدرس تصویر *</label>
            <input type="url" id="product-image" required placeholder="https://example.com/image.jpg" />
          </div>
          
          <div class="form-group">
            <label for="product-description">توضیحات</label>
            <textarea id="product-description" rows="3" placeholder="توضیحات محصول را وارد کنید..."></textarea>
          </div>
          
          <div class="form-group">
            <label>برچسب‌های ویژه</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="product-new" />
                <label for="product-new">محصول جدید</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="product-popular" />
                <label for="product-popular">محصول محبوب</label>
              </div>
            </div>
          </div>
          
          <button type="submit" class="btn btn-primary">افزودن محصول</button>
          <button type="button" class="btn btn-warning" onclick="cancelEdit()" id="cancel-edit-btn" style="display: none;">لغو ویرایش</button>
        </form>
      </div>

      <!-- مدیریت پیشنهادات -->
      <div class="section-card">
        <h3 class="section-title">مدیریت پیشنهادات ویژه</h3>
        <form id="recommendation-form">
          <div class="form-group">
            <label for="recommendation-name">نام محصول *</label>
            <input type="text" id="recommendation-name" required />
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="recommendation-price">قیمت (تومان) *</label>
              <input type="number" id="recommendation-price" required min="0" />
            </div>
            <div class="form-group">
              <label for="recommendation-image">آدرس تصویر *</label>
              <input type="url" id="recommendation-image" required placeholder="https://example.com/image.jpg" />
            </div>
          </div>
          
          <button type="submit" class="btn btn-success">افزودن پیشنهاد</button>
          <button type="button" class="btn btn-warning" onclick="cancelRecommendationEdit()" id="cancel-recommendation-edit-btn" style="display: none;">لغو ویرایش</button>
        </form>
      </div>

      <!-- تنظیمات نمایش محصولات -->
      <div class="section-card">
        <h3 class="section-title">تنظیمات نمایش محصولات</h3>
        <form id="display-settings-form">
          <div class="form-row">
            <div class="form-group">
              <label for="default-layout">نمایش پیش‌فرض</label>
              <select id="default-layout">
                <option value="grid-4">4 ستونه</option>
                <option value="grid-3">3 ستونه</option>
                <option value="grid-2">2 ستونه</option>
                <option value="list-view">لیستی</option>
              </select>
            </div>
            <div class="form-group">
              <label for="products-per-page">تعداد محصول در صفحه</label>
              <input type="number" id="products-per-page" min="8" max="50" value="20" />
            </div>
          </div>
          
          <div class="form-group">
            <label>فیلترهای فعال</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="enable-category-filter" checked />
                <label for="enable-category-filter">فیلتر دسته‌بندی</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="enable-price-filter" checked />
                <label for="enable-price-filter">فیلتر قیمت</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="enable-search" checked />
                <label for="enable-search">جستجو</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="enable-sort" checked />
                <label for="enable-sort">مرتب‌سازی</label>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>نمایش اطلاعات</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="show-stats" checked />
                <label for="show-stats">آمار محصولات</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="show-rating" checked />
                <label for="show-rating">امتیاز محصولات</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="show-stock" checked />
                <label for="show-stock">وضعیت موجودی</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="show-category" checked />
                <label for="show-category">دسته‌بندی</label>
              </div>
            </div>
          </div>
          
          <button type="submit" class="btn btn-primary">ذخیره تنظیمات</button>
        </form>
      </div>
    </div>

    <!-- جدول پیشنهادات -->
    <div class="products-table">
      <div class="table-header">
        <h2>پیشنهادات ویژه</h2>
      </div>
      <div class="table-container">
        <table id="recommendations-table">
          <thead>
            <tr>
              <th>تصویر</th>
              <th>نام محصول</th>
              <th>قیمت</th>
              <th>عملیات</th>
            </tr>
          </thead>
          <tbody id="recommendations-tbody">
            <!-- پیشنهادات اینجا رندر می‌شوند -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- جدول محصولات -->
    <div class="products-table">
      <div class="table-header">
        <h2>مدیریت محصولات</h2>
      </div>
      <div class="table-container">
        <table id="products-table">
<thead>
  <tr>
              <th>تصویر</th>
              <th>نام محصول</th>
              <th>دسته‌بندی</th>
    <th>قیمت</th>
              <th>موجودی</th>
              <th>امتیاز</th>
              <th>برچسب‌ها</th>
    <th>عملیات</th>
  </tr>
</thead>
          <tbody id="products-tbody">
            <!-- محصولات اینجا رندر می‌شوند -->
    </tbody>
  </table>
      </div>
    </div>

    <!-- جدول سفارشات -->
    <div class="products-table">
      <div class="table-header">
        <h2>سفارشات اخیر و اطلاعات اکانت‌ها</h2>
      </div>
      <div class="table-container">
        <table id="orders-table">
    <thead>
      <tr>
              <th>اطلاعات کاربر</th>
              <th>سبد خرید</th>
              <th>تعداد محصولات</th>
              <th>مبلغ کل</th>
              <th>تاریخ آخرین فعالیت</th>
              <th>وضعیت</th>
              <th>عملیات</th>
      </tr>
    </thead>
          <tbody id="orders-tbody">
            <!-- سفارشات اینجا رندر می‌شوند -->
    </tbody>
  </table>
      </div>
    </div>

    <!-- بخش‌های پیشرفته -->
    <div class="admin-sections">
      <!-- تحلیل‌های پیشرفته -->
      <div class="section-card" id="analytics-section" style="display: none;">
        <h3 class="section-title">📊 تحلیل‌های پیشرفته</h3>
        <div class="analytics-grid">
          <div class="analytics-card">
            <h4>📈 روند فروش</h4>
            <div class="chart-container">
              <canvas id="salesChart" width="300" height="200"></canvas>
            </div>
          </div>
          <div class="analytics-card">
            <h4>🛒 محبوب‌ترین محصولات</h4>
            <div id="popularProducts">
              <!-- محصولات محبوب اینجا نمایش داده می‌شوند -->
            </div>
          </div>
          <div class="analytics-card">
            <h4>👥 رفتار کاربران</h4>
            <div id="userBehavior">
              <!-- آمار رفتار کاربران -->
            </div>
          </div>
          <div class="analytics-card">
            <h4>💰 تحلیل درآمد</h4>
            <div id="revenueAnalysis">
              <!-- تحلیل درآمد -->
            </div>
          </div>
        </div>
        <button class="btn btn-primary" onclick="generateReport()">📄 تولید گزارش</button>
        <button class="btn btn-warning" onclick="exportAnalytics()">📤 صادرات داده‌ها</button>
      </div>

      <!-- مدیریت پشتیبان -->
      <div class="section-card" id="backup-section" style="display: none;">
        <h3 class="section-title">💾 مدیریت پشتیبان</h3>
        <div class="backup-controls">
          <div class="backup-action">
            <h4>🔄 ایجاد پشتیبان</h4>
            <p>ایجاد نسخه پشتیبان از تمام داده‌های فروشگاه</p>
            <button class="btn btn-success" onclick="createBackup()">ایجاد پشتیبان</button>
          </div>
          <div class="backup-action">
            <h4>📥 بازگردانی</h4>
            <p>بازگردانی داده‌ها از نسخه پشتیبان</p>
            <input type="file" id="backup-file" accept=".json" style="display: none;">
            <button class="btn btn-warning" onclick="document.getElementById('backup-file').click()">انتخاب فایل</button>
          </div>
          <div class="backup-action">
            <h4>🗑️ پاکسازی داده‌ها</h4>
            <p>پاک کردن تمام داده‌های فروشگاه</p>
            <button class="btn btn-danger" onclick="clearAllData()">پاکسازی کامل</button>
          </div>
        </div>
        <div id="backup-list">
          <h4>📋 لیست پشتیبان‌ها</h4>
          <div id="backup-items">
            <!-- لیست پشتیبان‌ها -->
          </div>
        </div>
      </div>

      <!-- تنظیمات هوشمند -->
      <div class="section-card" id="ai-section" style="display: none;">
        <h3 class="section-title">🤖 تنظیمات هوشمند</h3>
        <div class="ai-settings">
          <div class="ai-feature">
            <h4>🎯 پیشنهادات هوشمند</h4>
            <div class="checkbox-item">
              <input type="checkbox" id="ai-recommendations" checked>
              <label for="ai-recommendations">فعال کردن پیشنهادات هوشمند</label>
            </div>
            <div class="form-group">
              <label>الگوریتم پیشنهاد:</label>
              <select id="ai-algorithm">
                <option value="popularity">محبوبیت</option>
                <option value="category">دسته‌بندی</option>
                <option value="price">قیمت</option>
                <option value="hybrid">ترکیبی</option>
              </select>
            </div>
          </div>
          
          <div class="ai-feature">
            <h4>📊 تحلیل خودکار</h4>
            <div class="checkbox-item">
              <input type="checkbox" id="auto-analytics" checked>
              <label for="auto-analytics">تحلیل خودکار داده‌ها</label>
            </div>
            <div class="form-group">
              <label>فرکانس تحلیل:</label>
              <select id="analytics-frequency">
                <option value="daily">روزانه</option>
                <option value="weekly">هفتگی</option>
                <option value="monthly">ماهانه</option>
              </select>
            </div>
          </div>
          
          <div class="ai-feature">
            <h4>⚡ بهینه‌سازی خودکار</h4>
            <div class="checkbox-item">
              <input type="checkbox" id="auto-optimization">
              <label for="auto-optimization">بهینه‌سازی خودکار قیمت‌ها</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="auto-stock">
              <label for="auto-stock">مدیریت خودکار موجودی</label>
            </div>
          </div>
          
          <button class="btn btn-primary" onclick="saveAISettings()">💾 ذخیره تنظیمات هوشمند</button>
          <button class="btn btn-warning" onclick="runAIAnalysis()">🔍 اجرای تحلیل هوشمند</button>
        </div>
      </div>

      <!-- مدیریت امنیت -->
      <div class="section-card">
        <h3 class="section-title">🔒 مدیریت امنیت</h3>
        <div class="security-settings">
          <div class="security-feature">
            <h4>🔐 رمز عبور ادمین</h4>
            <div class="form-group">
              <label>رمز عبور جدید:</label>
              <input type="password" id="new-admin-password" placeholder="رمز عبور جدید">
            </div>
            <button class="btn btn-warning" onclick="changeAdminPassword()">تغییر رمز عبور</button>
          </div>
          
          <div class="security-feature">
            <h4>📝 لاگ فعالیت‌ها</h4>
            <div id="activity-log">
              <!-- لاگ فعالیت‌ها -->
            </div>
            <button class="btn btn-primary" onclick="exportActivityLog()">📤 صادرات لاگ</button>
          </div>
          
          <div class="security-feature">
            <h4>🚨 هشدارهای امنیتی</h4>
            <div class="checkbox-item">
              <input type="checkbox" id="security-alerts" checked>
              <label for="security-alerts">فعال کردن هشدارهای امنیتی</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="login-notifications" checked>
              <label for="login-notifications">اعلان ورود به پنل</label>
            </div>
          </div>
        </div>
      </div>

      <!-- تنظیمات پیشرفته -->
      <div class="section-card">
        <h3 class="section-title">⚙️ تنظیمات پیشرفته</h3>
        <div class="advanced-settings">
          <div class="setting-group">
            <h4>🎨 تنظیمات ظاهری</h4>
            <div class="form-group">
              <label>تم رنگی:</label>
              <select id="theme-selector">
                <option value="default">پیش‌فرض</option>
                <option value="dark">تاریک</option>
                <option value="light">روشن</option>
                <option value="custom">سفارشی</option>
              </select>
            </div>
            <div class="form-group">
              <label>اندازه فونت:</label>
              <select id="font-size">
                <option value="small">کوچک</option>
                <option value="medium" selected>متوسط</option>
                <option value="large">بزرگ</option>
              </select>
            </div>
          </div>
          
          <div class="setting-group">
            <h4>🔔 اعلان‌ها</h4>
            <div class="checkbox-item">
              <input type="checkbox" id="email-notifications" checked>
              <label for="email-notifications">اعلان‌های ایمیل</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="browser-notifications" checked>
              <label for="browser-notifications">اعلان‌های مرورگر</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="sound-notifications">
              <label for="sound-notifications">اعلان‌های صوتی</label>
            </div>
          </div>
          
          <div class="setting-group">
            <h4>📱 تنظیمات موبایل</h4>
            <div class="checkbox-item">
              <input type="checkbox" id="mobile-optimization" checked>
              <label for="mobile-optimization">بهینه‌سازی موبایل</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="touch-gestures" checked>
              <label for="touch-gestures">حرکات لمسی</label>
            </div>
          </div>
          
          <button class="btn btn-primary" onclick="saveAdvancedSettings()">💾 ذخیره تنظیمات</button>
          <button class="btn btn-warning" onclick="resetAdvancedSettings()">🔄 بازنشانی</button>
        </div>
      </div>
    </div>

    <!-- بخش‌های جدید پیشرفته -->
    <div class="admin-sections" id="advanced-features-section" style="display: none;">
      <!-- جستجوی پیشرفته -->
      <div class="section-card">
        <h3 class="section-title">🔍 جستجو و فیلتر پیشرفته</h3>
        <div class="advanced-search">
          <div class="search-filters">
            <div class="form-group">
              <label>جستجو در:</label>
              <input type="text" id="advanced-search-input" placeholder="نام محصول، دسته‌بندی، توضیحات...">
            </div>
            <div class="form-group">
              <label>دسته‌بندی:</label>
              <select id="category-filter">
                <option value="">همه دسته‌ها</option>
                <option value="الکترونیک">الکترونیک</option>
                <option value="پوشاک">پوشاک</option>
                <option value="کتاب">کتاب</option>
                <option value="ورزشی">ورزشی</option>
                <option value="خانگی">خانگی</option>
              </select>
            </div>
            <div class="form-group">
              <label>محدوده قیمت:</label>
              <div style="display: flex; gap: 10px;">
                <input type="number" id="min-price" placeholder="حداقل">
                <input type="number" id="max-price" placeholder="حداکثر">
              </div>
            </div>
            <div class="form-group">
              <label>وضعیت موجودی:</label>
              <select id="stock-filter">
                <option value="">همه</option>
                <option value="in-stock">موجود</option>
                <option value="low-stock">کم‌موجود</option>
                <option value="out-of-stock">ناموجود</option>
              </select>
            </div>
          </div>
          <button class="btn btn-primary" onclick="performAdvancedSearch()">🔍 جستجو</button>
          <button class="btn btn-warning" onclick="clearAdvancedSearch()">پاک کردن فیلترها</button>
        </div>
      </div>

      <!-- عملیات گروهی -->
      <div class="section-card">
        <h3 class="section-title">📦 عملیات گروهی محصولات</h3>
        <div class="bulk-actions" id="bulk-actions">
          <h4>عملیات روی محصولات انتخاب شده:</h4>
          <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button class="btn btn-warning" onclick="bulkEdit()">✏️ ویرایش گروهی</button>
            <button class="btn btn-danger" onclick="bulkDelete()">🗑️ حذف گروهی</button>
            <button class="btn btn-success" onclick="bulkExport()">📤 صادرات گروهی</button>
            <button class="btn btn-primary" onclick="bulkDiscount()">💰 تخفیف گروهی</button>
          </div>
          <div id="bulk-selection-info">0 محصول انتخاب شده</div>
        </div>
        <button class="btn btn-primary" onclick="toggleBulkSelection()">📋 انتخاب گروهی</button>
      </div>

      <!-- مدیریت کاربران -->
      <div class="section-card">
        <h3 class="section-title">👥 مدیریت کاربران</h3>
        <div class="user-management">
          <div id="users-list">
            <!-- لیست کاربران اینجا نمایش داده می‌شود -->
          </div>
          <button class="btn btn-primary" onclick="refreshUsersList()">🔄 بروزرسانی لیست</button>
          <button class="btn btn-warning" onclick="exportUsersData()">📤 صادرات داده‌های کاربران</button>
        </div>
      </div>

      <!-- واردات و صادرات -->
      <div class="section-card">
        <h3 class="section-title">📁 واردات و صادرات</h3>
        <div class="import-export">
          <div class="form-group">
            <label>صادرات محصولات:</label>
            <button class="btn btn-success" onclick="exportProducts()">📤 صادرات JSON</button>
            <button class="btn btn-primary" onclick="exportProductsCSV()">📊 صادرات CSV</button>
          </div>
          
          <div class="form-group">
            <label>واردات محصولات:</label>
            <div class="file-upload" id="import-upload" onclick="document.getElementById('import-file').click()">
              <div>📁 فایل را اینجا رها کنید یا کلیک کنید</div>
              <div style="font-size: 12px; color: #666; margin-top: 10px;">پشتیبانی از JSON و CSV</div>
            </div>
            <input type="file" id="import-file" accept=".json,.csv" style="display: none;" onchange="handleFileImport(event)">
          </div>
          
          <div class="form-group">
            <label>تنظیمات صادرات:</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="export-images" checked>
                <label for="export-images">شامل تصاویر</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="export-descriptions" checked>
                <label for="export-descriptions">شامل توضیحات</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="export-stats" checked>
                <label for="export-stats">شامل آمار</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- بخش پیش‌بینی فروش -->
    <div class="admin-sections" id="forecast-section" style="display: none;">
      <div class="section-card">
        <h3 class="section-title">📈 پیش‌بینی فروش و تحلیل‌های پیشرفته</h3>
        
        <div class="performance-metrics">
          <div class="metric-card">
            <div class="metric-value" id="forecast-revenue">0</div>
            <div class="metric-label">درآمد پیش‌بینی شده (ماه آینده)</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="forecast-orders">0</div>
            <div class="metric-label">سفارشات پیش‌بینی شده</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="growth-rate">0%</div>
            <div class="metric-label">نرخ رشد</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="conversion-rate">0%</div>
            <div class="metric-label">نرخ تبدیل</div>
          </div>
        </div>

        <div class="chart-container">
          <h4>📊 نمودار پیش‌بینی فروش</h4>
          <div class="forecast-chart" id="forecast-chart">
            نمودار پیش‌بینی فروش
          </div>
          <button class="btn btn-primary" onclick="generateForecast()">🔮 تولید پیش‌بینی</button>
          <button class="btn btn-warning" onclick="exportForecast()">📤 صادرات گزارش</button>
        </div>

        <div class="inventory-alert" id="inventory-alerts">
          <h4>⚠️ هشدارهای موجودی</h4>
          <div id="low-stock-alerts">
            <!-- هشدارهای موجودی کم -->
          </div>
        </div>
      </div>
    </div>

    <!-- داشبورد امنیت -->
    <div class="admin-sections" id="security-section" style="display: none;">
      <div class="section-card">
        <h3 class="section-title">🔒 داشبورد امنیت و نظارت</h3>
        
        <div class="security-dashboard">
          <div class="security-card">
            <h4>🛡️ وضعیت امنیت</h4>
            <div id="security-status">
              <div style="margin-bottom: 10px;">
                <span style="color: #27ae60;">✅ رمز عبور قوی</span>
              </div>
              <div style="margin-bottom: 10px;">
                <span style="color: #27ae60;">✅ لاگ فعالیت‌ها فعال</span>
              </div>
              <div style="margin-bottom: 10px;">
                <span style="color: #f39c12;">⚠️ نیاز به بررسی لاگ‌ها</span>
              </div>
            </div>
            <button class="btn btn-warning" onclick="runSecurityScan()">🔍 اسکن امنیتی</button>
          </div>
          
          <div class="security-card">
            <h4>📊 آمار فعالیت‌ها</h4>
            <div id="activity-stats">
              <div style="margin-bottom: 10px;">
                <strong>ورودهای امروز:</strong> <span id="today-logins">0</span>
              </div>
              <div style="margin-bottom: 10px;">
                <strong>عملیات ادمین:</strong> <span id="admin-actions">0</span>
              </div>
              <div style="margin-bottom: 10px;">
                <strong>آخرین ورود:</strong> <span id="last-login">نامشخص</span>
              </div>
            </div>
            <button class="btn btn-primary" onclick="viewDetailedLogs()">📋 مشاهده لاگ‌ها</button>
          </div>
          
          <div class="security-card">
            <h4>🚨 هشدارهای امنیتی</h4>
            <div id="security-alerts">
              <!-- هشدارهای امنیتی -->
            </div>
            <button class="btn btn-danger" onclick="clearSecurityAlerts()">پاک کردن هشدارها</button>
          </div>
        </div>
      </div>
    </div>

    <!-- سیستم اعلان‌های کاربران -->
    <div class="admin-sections" id="user-notifications-section" style="display: none;">
      <div class="section-card">
        <h3 class="section-title">📢 سیستم اعلان‌های کاربران</h3>
        
        <div class="notification-system">
          <h4>🎯 ارسال اعلان جدید</h4>
          
          <div class="form-group">
            <label>نوع اعلان:</label>
            <div class="notification-types">
              <div class="notification-type active" onclick="selectNotificationType('info', this)">
                <div style="font-weight: 600;">ℹ️ اطلاع‌رسانی</div>
                <div style="font-size: 12px; color: #666;">پیام‌های عمومی</div>
              </div>
              <div class="notification-type" onclick="selectNotificationType('success', this)">
                <div style="font-weight: 600;">✅ موفقیت</div>
                <div style="font-size: 12px; color: #666;">پیام‌های مثبت</div>
              </div>
              <div class="notification-type" onclick="selectNotificationType('warning', this)">
                <div style="font-weight: 600;">⚠️ هشدار</div>
                <div style="font-size: 12px; color: #666;">پیام‌های مهم</div>
              </div>
              <div class="notification-type" onclick="selectNotificationType('promotion', this)">
                <div style="font-weight: 600;">🎉 تبلیغات</div>
                <div style="font-size: 12px; color: #666;">تخفیف و پیشنهاد</div>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label>عنوان اعلان:</label>
            <input type="text" id="notification-title" placeholder="عنوان اعلان را وارد کنید..." style="width: 100%;">
          </div>
          
          <div class="form-group">
            <label>متن اعلان:</label>
            <textarea id="notification-message" rows="4" placeholder="متن اعلان را وارد کنید..." style="width: 100%;"></textarea>
          </div>
          
          <div class="form-group">
            <label>انتخاب گیرندگان:</label>
            <div style="margin-bottom: 10px;">
              <button class="btn btn-primary" onclick="selectAllUsers()">انتخاب همه کاربران</button>
              <button class="btn btn-warning" onclick="clearUserSelection()">پاک کردن انتخاب</button>
            </div>
            <div class="user-selector" id="user-selector">
              <!-- لیست کاربران اینجا نمایش داده می‌شود -->
            </div>
          </div>
          
          <div class="form-group">
            <label>تنظیمات ارسال:</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="show-immediately" checked>
                <label for="show-immediately">نمایش فوری</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="show-once">
                <label for="show-once">نمایش یکبار</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="persistent-notification">
                <label for="persistent-notification">اعلان پایدار</label>
              </div>
            </div>
          </div>
          
          <div class="message-preview" id="message-preview">
            <h5>پیش‌نمایش اعلان:</h5>
            <div id="preview-content">هیچ اعلانی انتخاب نشده</div>
          </div>
          
          <div style="margin-top: 20px;">
            <button class="btn btn-success" onclick="sendNotification()">📤 ارسال اعلان</button>
            <button class="btn btn-primary" onclick="scheduleNotification()">⏰ زمان‌بندی اعلان</button>
            <button class="btn btn-warning" onclick="saveNotificationTemplate()">💾 ذخیره قالب</button>
          </div>
        </div>
        
        <!-- تاریخچه اعلان‌ها -->
        <div class="notification-history">
          <h4>📋 تاریخچه اعلان‌ها</h4>
          <div id="notification-history-list">
            <!-- تاریخچه اعلان‌ها -->
          </div>
          <button class="btn btn-primary" onclick="loadNotificationHistory()">🔄 بروزرسانی تاریخچه</button>
        </div>
        
        <!-- اعلان‌های زمان‌بندی شده -->
        <div class="scheduled-notifications">
          <h4>⏰ اعلان‌های زمان‌بندی شده</h4>
          <div id="scheduled-notifications-list">
            <!-- اعلان‌های زمان‌بندی شده -->
          </div>
          <button class="btn btn-warning" onclick="loadScheduledNotifications()">🔄 بروزرسانی</button>
        </div>
      </div>
    </div>

    <!-- تنظیمات پیشرفته -->
    <div class="admin-sections" id="advanced-settings-section" style="display: none;">
      <div class="section-card">
        <h3 class="section-title">⚙️ تنظیمات پیشرفته سایت</h3>
        
        <div class="advanced-settings-grid">
          <!-- تنظیمات ظاهری -->
          <div class="setting-panel">
            <h4>🎨 تنظیمات ظاهری</h4>
            <div class="form-group">
              <label>تم رنگی:</label>
              <div class="color-picker">
                <div class="color-option selected" style="background: #667eea;" onclick="selectColor('#667eea', this)"></div>
                <div class="color-option" style="background: #27ae60;" onclick="selectColor('#27ae60', this)"></div>
                <div class="color-option" style="background: #e74c3c;" onclick="selectColor('#e74c3c', this)"></div>
                <div class="color-option" style="background: #f39c12;" onclick="selectColor('#f39c12', this)"></div>
                <div class="color-option" style="background: #9b59b6;" onclick="selectColor('#9b59b6', this)"></div>
                <div class="color-option" style="background: #34495e;" onclick="selectColor('#34495e', this)"></div>
              </div>
            </div>
            
            <div class="form-group">
              <label>فونت سایت:</label>
              <div class="font-selector">
                <div class="font-option selected" onclick="selectFont('default', this)">پیش‌فرض</div>
                <div class="font-option" onclick="selectFont('tahoma', this)">Tahoma</div>
                <div class="font-option" onclick="selectFont('arial', this)">Arial</div>
                <div class="font-option" onclick="selectFont('times', this)">Times</div>
              </div>
            </div>
            
            <div class="form-group">
              <label>اندازه فونت:</label>
              <select id="site-font-size">
                <option value="small">کوچک</option>
                <option value="medium" selected>متوسط</option>
                <option value="large">بزرگ</option>
              </select>
            </div>
            
            <button class="btn btn-primary" onclick="saveAppearanceSettings()">💾 ذخیره تنظیمات ظاهری</button>
          </div>
          
          <!-- تنظیمات عملکرد -->
          <div class="setting-panel">
            <h4>⚡ تنظیمات عملکرد</h4>
            <div class="form-group">
              <label>حالت عملکرد:</label>
              <select id="performance-mode">
                <option value="normal">عادی</option>
                <option value="optimized">بهینه</option>
                <option value="turbo">توربو</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>تنظیمات کش:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="enable-cache" checked>
                  <label for="enable-cache">فعال کردن کش</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="enable-compression">
                  <label for="enable-compression">فشرده‌سازی</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="enable-lazy-loading" checked>
                  <label for="enable-lazy-loading">بارگذاری تنبل</label>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label>محدودیت‌های عملکرد:</label>
              <div style="display: flex; gap: 10px;">
                <input type="number" id="max-requests" placeholder="حداکثر درخواست" value="100">
                <input type="number" id="timeout" placeholder="تایم‌اوت (ثانیه)" value="30">
              </div>
            </div>
            
            <button class="btn btn-primary" onclick="savePerformanceSettings()">💾 ذخیره تنظیمات عملکرد</button>
          </div>
          
          <!-- تنظیمات امنیت -->
          <div class="setting-panel">
            <h4>🔒 تنظیمات امنیت</h4>
            <div class="form-group">
              <label>سطح امنیت:</label>
              <select id="security-level">
                <option value="low">کم</option>
                <option value="medium" selected>متوسط</option>
                <option value="high">زیاد</option>
                <option value="extreme">خیلی زیاد</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>تنظیمات امنیتی:</label>
              <div class="checkbox-group">
                <div class="checkbox-item">
                  <input type="checkbox" id="enable-captcha" checked>
                  <label for="enable-captcha">فعال کردن کپچا</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="enable-rate-limiting" checked>
                  <label for="enable-rate-limiting">محدودیت نرخ</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="enable-ssl">
                  <label for="enable-ssl">SSL اجباری</label>
                </div>
                <div class="checkbox-item">
                  <input type="checkbox" id="enable-2fa">
                  <label for="enable-2fa">احراز هویت دو مرحله‌ای</label>
                </div>
              </div>
            </div>
            
            <button class="btn btn-primary" onclick="saveSecuritySettings()">💾 ذخیره تنظیمات امنیت</button>
          </div>
        </div>
        
        <!-- نظارت بر عملکرد -->
        <div class="performance-monitor">
          <h4>📊 نظارت بر عملکرد</h4>
          <div class="performance-metric">
            <span>سرعت بارگذاری</span>
            <span>2.3s</span>
            <div class="metric-bar">
              <div class="metric-fill" style="width: 75%;"></div>
            </div>
          </div>
          <div class="performance-metric">
            <span>استفاده از حافظه</span>
            <span>45%</span>
            <div class="metric-bar">
              <div class="metric-fill" style="width: 45%;"></div>
            </div>
          </div>
          <div class="performance-metric">
            <span>درخواست‌های همزمان</span>
            <span>12</span>
            <div class="metric-bar">
              <div class="metric-fill" style="width: 60%;"></div>
            </div>
          </div>
          <button class="btn btn-warning" onclick="refreshPerformanceMetrics()">🔄 بروزرسانی آمار</button>
        </div>
        
        <!-- قوانین خودکار -->
        <div class="automation-rules">
          <h4>🤖 قوانین خودکار</h4>
          <div class="rule-item">
            <div class="rule-header">
              <span>🔄 پشتیبان‌گیری خودکار</span>
              <span class="rule-status active">فعال</span>
            </div>
            <div>پشتیبان‌گیری روزانه از داده‌ها</div>
            <button class="btn btn-warning" onclick="toggleRule('backup')">تغییر وضعیت</button>
          </div>
          
          <div class="rule-item">
            <div class="rule-header">
              <span>📧 اعلان موجودی کم</span>
              <span class="rule-status active">فعال</span>
            </div>
            <div>اعلان خودکار برای محصولات کم‌موجود</div>
            <button class="btn btn-warning" onclick="toggleRule('stock')">تغییر وضعیت</button>
          </div>
          
          <div class="rule-item">
            <div class="rule-header">
              <span>🧹 پاکسازی خودکار</span>
              <span class="rule-status inactive">غیرفعال</span>
            </div>
            <div>پاکسازی لاگ‌های قدیمی</div>
            <button class="btn btn-warning" onclick="toggleRule('cleanup')">تغییر وضعیت</button>
          </div>
        </div>
        
        <!-- یکپارچه‌سازی -->
        <div class="integration-panel">
          <h4>🔗 یکپارچه‌سازی</h4>
          <div class="integration-item">
            <div>
              <strong>📧 ایمیل</strong>
              <div style="font-size: 12px; color: #666;">ارسال اعلان‌ها از طریق ایمیل</div>
            </div>
            <span class="integration-status connected">متصل</span>
          </div>
          
          <div class="integration-item">
            <div>
              <strong>📱 پیامک</strong>
              <div style="font-size: 12px; color: #666;">ارسال پیامک به کاربران</div>
            </div>
            <span class="integration-status disconnected">قطع</span>
          </div>
          
          <div class="integration-item">
            <div>
              <strong>💬 تلگرام</strong>
              <div style="font-size: 12px; color: #666;">ربات تلگرام</div>
            </div>
            <span class="integration-status pending">در انتظار</span>
          </div>
          
          <button class="btn btn-primary" onclick="configureIntegrations()">⚙️ تنظیم یکپارچه‌سازی</button>
        </div>
      </div>
    </div>
  </div>

 <script>
    // بارگذاری اولیه
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Admin panel loaded');
      loadProducts();
      loadOrders();
      loadRecommendations();
      updateStats();
      loadDisplaySettings();
    });

    // فرم افزودن محصول
    document.getElementById('product-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const product = {
        id: Date.now(),
        name: document.getElementById('product-name').value,
        price: parseInt(document.getElementById('product-price').value),
        discount: parseInt(document.getElementById('product-discount').value) || 0,
        stock: parseInt(document.getElementById('product-stock').value),
        rating: parseFloat(document.getElementById('product-rating').value) || 0,
        category: document.getElementById('product-category').value,
        image: document.getElementById('product-image').value,
        description: document.getElementById('product-description').value,
        isNew: document.getElementById('product-new').checked,
        isPopular: document.getElementById('product-popular').checked
      };
      
      addProduct(product);
      this.reset();
      
      // بازگرداندن دکمه به حالت عادی
      const submitBtn = this.querySelector('button[type="submit"]');
      submitBtn.textContent = 'افزودن محصول';
      
      // مخفی کردن دکمه لغو
      document.getElementById('cancel-edit-btn').style.display = 'none';
    });

    // فرم افزودن پیشنهاد
    document.getElementById('recommendation-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const recommendation = {
        id: Date.now(),
        name: document.getElementById('recommendation-name').value,
        price: parseInt(document.getElementById('recommendation-price').value),
        image: document.getElementById('recommendation-image').value
      };
      
      addRecommendation(recommendation);
      this.reset();
      
      // بازگرداندن دکمه به حالت عادی
      const submitBtn = this.querySelector('button[type="submit"]');
      submitBtn.textContent = 'افزودن پیشنهاد';
      
      // مخفی کردن دکمه لغو
      document.getElementById('cancel-recommendation-edit-btn').style.display = 'none';
    });

    // افزودن محصول
    function addProduct(product) {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      products.push(product);
      localStorage.setItem('products', JSON.stringify(products));
      
      loadProducts();
      updateStats();
      alert('محصول با موفقیت اضافه شد!');
    }

    // بارگذاری محصولات
    function loadProducts() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const tbody = document.getElementById('products-tbody');
      
      console.log('Loading products:', products.length);
      
      tbody.innerHTML = '';
      
    if (products.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;">هیچ محصولی موجود نیست</td></tr>';
      return;
    }

      products.forEach(product => {
      const row = document.createElement('tr');
        
        const badges = [];
        if (product.discount > 0) badges.push(`<span class="badge discount">${product.discount}% تخفیف</span>`);
        if (product.isNew) badges.push('<span class="badge new">جدید</span>');
        if (product.isPopular) badges.push('<span class="badge popular">محبوب</span>');
        
        const stockClass = product.stock > 0 ? 'in-stock' : 'out-of-stock';
        const stockText = product.stock > 0 ? `${product.stock} عدد` : 'ناموجود';

      row.innerHTML = `
          <td><img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/60x60?text=تصویر'" /></td>
          <td>${product.name}</td>
          <td>${product.category || 'عمومی'}</td>
          <td>${product.price.toLocaleString()} تومان</td>
          <td><span class="stock-status ${stockClass}">${stockText}</span></td>
          <td>${product.rating ? product.rating.toFixed(1) : '0.0'} ⭐</td>
          <td>${badges.join(' ')}</td>
          <td>
            <button class="btn btn-warning" onclick="editProduct(${product.id})">ویرایش</button>
            <button class="btn btn-danger" onclick="deleteProduct(${product.id})">حذف</button>
            <button class="btn btn-success" onclick="addToRecommendations(${product.id})">پیشنهاد</button>
        </td>
      `;
        
        tbody.appendChild(row);
      });
    }

    // حذف محصول
    function deleteProduct(id) {
      if (confirm('آیا از حذف این محصول اطمینان دارید؟')) {
        const products = JSON.parse(localStorage.getItem('products')) || [];
        const filteredProducts = products.filter(p => p.id !== id);
        localStorage.setItem('products', JSON.stringify(filteredProducts));
        
        loadProducts();
        updateStats();
        alert('محصول حذف شد!');
      }
    }

    // ویرایش محصول
    function editProduct(id) {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const product = products.find(p => p.id === id);
      
      if (product) {
        console.log('Editing product:', product);
        
        // پر کردن فرم با اطلاعات محصول
        document.getElementById('product-name').value = product.name;
        document.getElementById('product-price').value = product.price;
        document.getElementById('product-discount').value = product.discount || 0;
        document.getElementById('product-stock').value = product.stock;
        document.getElementById('product-rating').value = product.rating || 0;
        document.getElementById('product-category').value = product.category || 'عمومی';
        document.getElementById('product-image').value = product.image;
        document.getElementById('product-description').value = product.description || '';
        document.getElementById('product-new').checked = product.isNew || false;
        document.getElementById('product-popular').checked = product.isPopular || false;
        
        // تغییر متن دکمه فرم
        const submitBtn = document.querySelector('#product-form button[type="submit"]');
        submitBtn.textContent = 'ویرایش محصول';
        submitBtn.onclick = function(e) {
          e.preventDefault();
          updateProduct(id);
        };
        
        // نمایش دکمه لغو
        document.getElementById('cancel-edit-btn').style.display = 'inline-block';
        
        // اسکرول به فرم (بدون انیمیشن)
        document.getElementById('product-form').scrollIntoView();
        
        alert('اطلاعات محصول در فرم قرار گرفت. پس از ویرایش، روی "ویرایش محصول" کلیک کنید یا برای لغو روی "لغو ویرایش" کلیک کنید.');
      } else {
        alert('محصول مورد نظر یافت نشد!');
      }
    }

    // بروزرسانی محصول
    function updateProduct(id) {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const productIndex = products.findIndex(p => p.id === id);
      
      if (productIndex !== -1) {
        const updatedProduct = {
          id: id,
          name: document.getElementById('product-name').value,
          price: parseInt(document.getElementById('product-price').value),
          discount: parseInt(document.getElementById('product-discount').value) || 0,
          stock: parseInt(document.getElementById('product-stock').value),
          rating: parseFloat(document.getElementById('product-rating').value) || 0,
          category: document.getElementById('product-category').value,
          image: document.getElementById('product-image').value,
          description: document.getElementById('product-description').value,
          isNew: document.getElementById('product-new').checked,
          isPopular: document.getElementById('product-popular').checked
        };
        
        products[productIndex] = updatedProduct;
    localStorage.setItem('products', JSON.stringify(products));
        
        // بازگرداندن دکمه به حالت عادی
        const submitBtn = document.querySelector('#product-form button[type="submit"]');
        submitBtn.textContent = 'افزودن محصول';
        submitBtn.onclick = null;
        
        // مخفی کردن دکمه لغو
        document.getElementById('cancel-edit-btn').style.display = 'none';
        
        // پاک کردن فرم
        document.getElementById('product-form').reset();
        
        loadProducts();
        updateStats();
        alert('محصول با موفقیت ویرایش شد!');
      } else {
        alert('محصول مورد نظر یافت نشد!');
      }
    }

    // لغو ویرایش
    function cancelEdit() {
      // بازگرداندن دکمه به حالت عادی
      const submitBtn = document.querySelector('#product-form button[type="submit"]');
      submitBtn.textContent = 'افزودن محصول';
      submitBtn.onclick = null;
      
      // مخفی کردن دکمه لغو
      document.getElementById('cancel-edit-btn').style.display = 'none';
      
      // پاک کردن فرم
      document.getElementById('product-form').reset();
      
      alert('ویرایش لغو شد!');
    }

    // بارگذاری سفارشات و اطلاعات اکانت‌ها
    function loadOrders() {
      const tbody = document.getElementById('orders-tbody');
      tbody.innerHTML = '';
      
      // جمع‌آوری تمام کلیدهای localStorage که با 'cart_' شروع می‌شوند
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      if (cartKeys.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">هیچ سفارشی موجود نیست</td></tr>';
        return;
      }
      
      cartKeys.forEach((cartKey, index) => {
        const userEmail = cartKey.replace('cart_', '');
        const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
        
        if (cart.length === 0) return; // رد کردن سبدهای خالی
        
        // محاسبه آمار سبد خرید
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        // نمایش محصولات سبد خرید
        const cartItems = cart.map(item => 
          `${item.name} (${item.quantity} عدد)`
        ).join('<br>');
        
        const row = document.createElement('tr');
        
        // تعیین وضعیت بر اساس تعداد محصولات
        let status = '';
        let statusColor = '';
        if (totalItems === 0) {
          status = 'سبد خالی';
          statusColor = '#95a5a6';
        } else if (totalItems <= 3) {
          status = 'سبد کوچک';
          statusColor = '#3498db';
        } else if (totalItems <= 7) {
          status = 'سبد متوسط';
          statusColor = '#f39c12';
        } else {
          status = 'سبد بزرگ';
          statusColor = '#e74c3c';
        }
        
        row.innerHTML = `
          <td>
            <strong>${userEmail}</strong><br>
            <small style="color: #666;">کاربر شماره ${index + 1}</small>
          </td>
          <td style="max-width: 300px; font-size: 0.9rem;">
            ${cartItems || 'سبد خالی'}
          </td>
          <td><span style="color: #27ae60; font-weight: bold;">${totalItems}</span></td>
          <td><span style="color: #e74c3c; font-weight: bold;">${totalPrice.toLocaleString()} تومان</span></td>
          <td>${new Date().toLocaleDateString('fa-IR')}</td>
          <td><span style="color: ${statusColor}; font-weight: bold;">${status}</span></td>
          <td>
            <div class="cart-status-info">
              <div class="status-item">
                <span class="status-label">تعداد محصولات:</span>
                <span class="status-value">${totalItems}</span>
              </div>
              <div class="status-item">
                <span class="status-label">مبلغ کل:</span>
                <span class="status-value">${totalPrice.toLocaleString()} تومان</span>
              </div>
              <div class="status-item">
                <span class="status-label">وضعیت:</span>
                <span class="status-badge" style="background: ${statusColor};">${status}</span>
              </div>
            </div>
          </td>
        `;
        
        tbody.appendChild(row);
      });
      
      // اگر هیچ سبد خریدی وجود ندارد
      if (tbody.children.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;">هیچ سفارشی موجود نیست</td></tr>';
      }
    }

    // نمایش اطلاعات وضعیت سبد خرید
    function showCartStatus(userEmail) {
      const cartKey = `cart_${userEmail}`;
      const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      alert(`وضعیت سبد خرید ${userEmail}:\nتعداد محصولات: ${totalItems}\nمبلغ کل: ${totalPrice.toLocaleString()} تومان`);
    }

    // بارگذاری پیشنهادات
    function loadRecommendations() {
      const recommendations = JSON.parse(localStorage.getItem('recommendations')) || [];
      const tbody = document.getElementById('recommendations-tbody');
      
      console.log('Loading recommendations:', recommendations.length);
      
      tbody.innerHTML = '';
      
      if (recommendations.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 20px;">هیچ پیشنهادی موجود نیست</td></tr>';
        return;
      }

      recommendations.forEach(recommendation => {
        const row = document.createElement('tr');
        
        // بررسی اینکه آیا این پیشنهاد از محصولات موجود آمده یا نه
        const products = JSON.parse(localStorage.getItem('products')) || [];
        const isFromProducts = products.some(p => p.name === recommendation.name);
        
        row.innerHTML = `
          <td><img src="${recommendation.image}" alt="${recommendation.name}" class="product-image" onerror="this.src='https://via.placeholder.com/60x60?text=تصویر'" /></td>
          <td>${recommendation.name} ${isFromProducts ? '<span style="color: #27ae60; font-size: 0.8rem;">(از محصولات)</span>' : ''}</td>
          <td>${recommendation.price.toLocaleString()} تومان</td>
          <td>
            <button class="btn btn-warning" onclick="editRecommendation(${recommendation.id})">ویرایش</button>
            <button class="btn btn-danger" onclick="deleteRecommendation(${recommendation.id})">حذف</button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }

    // افزودن پیشنهاد
    function addRecommendation(recommendation) {
      const recommendations = JSON.parse(localStorage.getItem('recommendations')) || [];
      recommendations.push(recommendation);
      localStorage.setItem('recommendations', JSON.stringify(recommendations));
      
      loadRecommendations();
      alert('پیشنهاد با موفقیت اضافه شد!');
    }

    // حذف پیشنهاد
    function deleteRecommendation(id) {
      if (confirm('آیا از حذف این پیشنهاد اطمینان دارید؟')) {
        const recommendations = JSON.parse(localStorage.getItem('recommendations')) || [];

    // بارگذاری تنظیمات نمایش
    function loadDisplaySettings() {
      const settings = JSON.parse(localStorage.getItem('displaySettings')) || {
        defaultLayout: 'grid-4',
        productsPerPage: 20,
        enableCategoryFilter: true,
        enablePriceFilter: true,
        enableSearch: true,
        enableSort: true,
        showStats: true,
        showRating: true,
        showStock: true,
        showCategory: true
      };
      
      document.getElementById('default-layout').value = settings.defaultLayout;
      document.getElementById('products-per-page').value = settings.productsPerPage;
      document.getElementById('enable-category-filter').checked = settings.enableCategoryFilter;
      document.getElementById('enable-price-filter').checked = settings.enablePriceFilter;
      document.getElementById('enable-search').checked = settings.enableSearch;
      document.getElementById('enable-sort').checked = settings.enableSort;
      document.getElementById('show-stats').checked = settings.showStats;
      document.getElementById('show-rating').checked = settings.showRating;
      document.getElementById('show-stock').checked = settings.showStock;
      document.getElementById('show-category').checked = settings.showCategory;
    }

    // ذخیره تنظیمات نمایش
    function saveDisplaySettings() {
      const settings = {
        defaultLayout: document.getElementById('default-layout').value,
        productsPerPage: parseInt(document.getElementById('products-per-page').value),
        enableCategoryFilter: document.getElementById('enable-category-filter').checked,
        enablePriceFilter: document.getElementById('enable-price-filter').checked,
        enableSearch: document.getElementById('enable-search').checked,
        enableSort: document.getElementById('enable-sort').checked,
        showStats: document.getElementById('show-stats').checked,
        showRating: document.getElementById('show-rating').checked,
        showStock: document.getElementById('show-stock').checked,
        showCategory: document.getElementById('show-category').checked
      };
      
      localStorage.setItem('displaySettings', JSON.stringify(settings));
      alert('تنظیمات نمایش با موفقیت ذخیره شد!');
    }

    // فرم تنظیمات نمایش
    document.getElementById('display-settings-form').addEventListener('submit', function(e) {
      e.preventDefault();
      saveDisplaySettings();
    });
        const filteredRecommendations = recommendations.filter(r => r.id !== id);
        localStorage.setItem('recommendations', JSON.stringify(filteredRecommendations));
        
        loadRecommendations();
        alert('پیشنهاد حذف شد!');
      }
    }

    // ویرایش پیشنهاد
    function editRecommendation(id) {
      const recommendations = JSON.parse(localStorage.getItem('recommendations')) || [];
      const recommendation = recommendations.find(r => r.id === id);
      
      if (recommendation) {
        console.log('Editing recommendation:', recommendation);
        
        // پر کردن فرم با اطلاعات پیشنهاد
        document.getElementById('recommendation-name').value = recommendation.name;
        document.getElementById('recommendation-price').value = recommendation.price;
        document.getElementById('recommendation-image').value = recommendation.image;
        
        // تغییر متن دکمه فرم
        const submitBtn = document.querySelector('#recommendation-form button[type="submit"]');
        submitBtn.textContent = 'ویرایش پیشنهاد';
        submitBtn.onclick = function(e) {
          e.preventDefault();
          updateRecommendation(id);
        };
        
        // نمایش دکمه لغو
        document.getElementById('cancel-recommendation-edit-btn').style.display = 'inline-block';
        
        // اسکرول به فرم
        document.getElementById('recommendation-form').scrollIntoView();
        
        alert('اطلاعات پیشنهاد در فرم قرار گرفت. پس از ویرایش، روی "ویرایش پیشنهاد" کلیک کنید یا برای لغو روی "لغو ویرایش" کلیک کنید.');
      } else {
        alert('پیشنهاد مورد نظر یافت نشد!');
      }
    }

    // بروزرسانی پیشنهاد
    function updateRecommendation(id) {
      const recommendations = JSON.parse(localStorage.getItem('recommendations')) || [];
      const recommendationIndex = recommendations.findIndex(r => r.id === id);
      
      if (recommendationIndex !== -1) {
        const updatedRecommendation = {
          id: id,
          name: document.getElementById('recommendation-name').value,
          price: parseInt(document.getElementById('recommendation-price').value),
          image: document.getElementById('recommendation-image').value
        };
        
        recommendations[recommendationIndex] = updatedRecommendation;
        localStorage.setItem('recommendations', JSON.stringify(recommendations));
        
        // بازگرداندن دکمه به حالت عادی
        const submitBtn = document.querySelector('#recommendation-form button[type="submit"]');
        submitBtn.textContent = 'افزودن پیشنهاد';
        submitBtn.onclick = null;
        
        // مخفی کردن دکمه لغو
        document.getElementById('cancel-recommendation-edit-btn').style.display = 'none';
        
        // پاک کردن فرم
        document.getElementById('recommendation-form').reset();
        
        loadRecommendations();
        alert('پیشنهاد با موفقیت ویرایش شد!');
      } else {
        alert('پیشنهاد مورد نظر یافت نشد!');
      }
    }

    // لغو ویرایش پیشنهاد
    function cancelRecommendationEdit() {
      // بازگرداندن دکمه به حالت عادی
      const submitBtn = document.querySelector('#recommendation-form button[type="submit"]');
      submitBtn.textContent = 'افزودن پیشنهاد';
      submitBtn.onclick = null;
      
      // مخفی کردن دکمه لغو
      document.getElementById('cancel-recommendation-edit-btn').style.display = 'none';
      
      // پاک کردن فرم
      document.getElementById('recommendation-form').reset();
      
      alert('ویرایش لغو شد!');
    }

    // افزودن محصول به پیشنهادات
    function addToRecommendations(productId) {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const product = products.find(p => p.id === productId);
      
      if (!product) {
        alert('محصول مورد نظر یافت نشد!');
        return;
      }

      // بررسی اینکه آیا این محصول قبلاً در پیشنهادات وجود دارد
      const recommendations = JSON.parse(localStorage.getItem('recommendations')) || [];
      const existingRecommendation = recommendations.find(r => r.name === product.name);
      
      if (existingRecommendation) {
        alert('این محصول قبلاً در پیشنهادات موجود است!');
        return;
      }

      // ایجاد پیشنهاد جدید از محصول
      const newRecommendation = {
        id: Date.now(),
        name: product.name,
        price: product.price,
        image: product.image
      };

      // افزودن به پیشنهادات
      recommendations.push(newRecommendation);
      localStorage.setItem('recommendations', JSON.stringify(recommendations));
      
      // بروزرسانی جدول پیشنهادات
      loadRecommendations();
      
      alert(`محصول "${product.name}" به پیشنهادات اضافه شد!`);
    }

    // بروزرسانی آمار
    function updateStats() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      
      // جمع‌آوری تمام سبدهای خرید
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      let totalOrders = 0;
      let totalRevenue = 0;
      
      cartKeys.forEach(cartKey => {
        const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
        totalOrders += cart.length;
        totalRevenue += cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      });
      
      console.log('Updating stats - Products:', products.length, 'Orders:', totalOrders, 'Users:', cartKeys.length);
      
      document.getElementById('totalProducts').textContent = products.length;
      document.getElementById('totalOrders').textContent = cartKeys.length; // تعداد کاربران
      document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString();
      
      const lowStockCount = products.filter(p => p.stock > 0 && p.stock <= 5).length;
      document.getElementById('lowStock').textContent = lowStockCount;
    }

    // افزودن محصولات نمونه
    function addSampleProducts() {
      const sampleProducts = [
        {
          id: Date.now(),
          name: "لپ‌تاپ اپل مک‌بوک پرو",
          price: 85000000,
          discount: 15,
          stock: 5,
          rating: 4.8,
          category: "الکترونیک",
          image: "https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=300",
          description: "لپ‌تاپ قدرتمند اپل با پردازنده M2",
          isNew: true,
          isPopular: true
        },
        {
          id: Date.now() + 1,
          name: "کفش ورزشی نایک",
          price: 1200000,
          discount: 0,
          stock: 20,
          rating: 4.5,
          category: "ورزشی",
          image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300",
          description: "کفش ورزشی راحت و سبک",
          isNew: false,
          isPopular: true
        },
        {
          id: Date.now() + 2,
          name: "کتاب برنامه‌نویسی JavaScript",
          price: 450000,
          discount: 10,
          stock: 15,
          rating: 4.2,
          category: "کتاب",
          image: "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=300",
          description: "کتاب جامع آموزش JavaScript",
          isNew: true,
          isPopular: false
        }
      ];
      
      const existingProducts = JSON.parse(localStorage.getItem('products')) || [];
      const allProducts = [...existingProducts, ...sampleProducts];
      localStorage.setItem('products', JSON.stringify(allProducts));
      
      loadProducts();
      updateStats();
      alert('محصولات نمونه اضافه شدند!');
    }

    // بروزرسانی داده‌ها
    function refreshData() {
      loadProducts();
      loadOrders();
      loadCarouselImages();
      updateStats();
      loadMenuSettings();
      alert('داده‌ها بروزرسانی شدند!');
    }

    // بارگذاری تنظیمات منو
    function loadMenuSettings() {
      const menuSettings = JSON.parse(localStorage.getItem('menuSettings')) || getDefaultMenuSettings();
      
      // تنظیم checkbox ها
      document.getElementById('menu-all-products').checked = menuSettings.menu.allProducts;
      document.getElementById('menu-hats').checked = menuSettings.menu.hats;
      document.getElementById('menu-shorts').checked = menuSettings.menu.shorts;
      document.getElementById('menu-pants').checked = menuSettings.menu.pants;
      document.getElementById('menu-tshirts').checked = menuSettings.menu.tshirts;
      document.getElementById('menu-trust').checked = menuSettings.menu.trust;
      document.getElementById('menu-badges').checked = menuSettings.menu.badges;
      document.getElementById('menu-contact').checked = menuSettings.menu.contact;
      document.getElementById('menu-admin').checked = menuSettings.menu.admin;
      
      // تنظیم صفحات
      document.getElementById('page-contact').checked = menuSettings.pages.contact;
      document.getElementById('page-badges').checked = menuSettings.pages.badges;
      document.getElementById('page-about').checked = menuSettings.pages.about;
      
      // تنظیم دسته‌بندی‌ها
      document.getElementById('cat-hats').checked = menuSettings.categories.hats;
      document.getElementById('cat-shorts').checked = menuSettings.categories.shorts;
      document.getElementById('cat-pants').checked = menuSettings.categories.pants;
      document.getElementById('cat-tshirts').checked = menuSettings.categories.tshirts;
    }

    // تنظیمات پیش‌فرض منو
    function getDefaultMenuSettings() {
      return {
        menu: {
          allProducts: true,
          hats: true,
          shorts: true,
          pants: true,
          tshirts: true,
          trust: true,
          badges: true,
          contact: true,
          admin: true
        },
        pages: {
          contact: true,
          badges: true,
          about: true
        },
        categories: {
          hats: true,
          shorts: true,
          pants: true,
          tshirts: true
        }
      };
    }

    // ذخیره تنظیمات منو
    function saveMenuSettings() {
      const menuSettings = {
        menu: {
          allProducts: document.getElementById('menu-all-products').checked,
          hats: document.getElementById('menu-hats').checked,
          shorts: document.getElementById('menu-shorts').checked,
          pants: document.getElementById('menu-pants').checked,
          tshirts: document.getElementById('menu-tshirts').checked,
          trust: document.getElementById('menu-trust').checked,
          badges: document.getElementById('menu-badges').checked,
          contact: document.getElementById('menu-contact').checked,
          admin: document.getElementById('menu-admin').checked
        },
        pages: {
          contact: document.getElementById('page-contact').checked,
          badges: document.getElementById('page-badges').checked,
          about: document.getElementById('page-about').checked
        },
        categories: {
          hats: document.getElementById('cat-hats').checked,
          shorts: document.getElementById('cat-shorts').checked,
          pants: document.getElementById('cat-pants').checked,
          tshirts: document.getElementById('cat-tshirts').checked
        }
      };
      
      localStorage.setItem('menuSettings', JSON.stringify(menuSettings));
      alert('تنظیمات منو با موفقیت ذخیره شد!');
    }

    // بازنشانی تنظیمات منو
    function resetMenuSettings() {
      if (confirm('آیا مطمئن هستید که می‌خواهید تنظیمات منو را به حالت پیش‌فرض بازگردانید؟')) {
        const defaultSettings = getDefaultMenuSettings();
        localStorage.setItem('menuSettings', JSON.stringify(defaultSettings));
        loadMenuSettings();
        alert('تنظیمات منو به حالت پیش‌فرض بازگردانده شد!');
      }
    }

    // بارگذاری تنظیمات منو در هنگام بارگذاری صفحه
    document.addEventListener('DOMContentLoaded', function() {
      loadMenuSettings();
      loadActivityLog();
      loadAdvancedSettings();
    });

    // ===== توابع پیشرفته =====

    // نمایش تحلیل‌های پیشرفته
    function showAnalytics() {
      const analyticsSection = document.getElementById('analytics-section');
      const backupSection = document.getElementById('backup-section');
      const aiSection = document.getElementById('ai-section');
      
      analyticsSection.style.display = 'block';
      backupSection.style.display = 'none';
      aiSection.style.display = 'none';
      
      loadAnalytics();
    }

    // نمایش مدیریت پشتیبان
    function showBackupManager() {
      const analyticsSection = document.getElementById('analytics-section');
      const backupSection = document.getElementById('backup-section');
      const aiSection = document.getElementById('ai-section');
      
      analyticsSection.style.display = 'none';
      backupSection.style.display = 'block';
      aiSection.style.display = 'none';
      
      loadBackupList();
    }

    // نمایش تنظیمات هوشمند
    function showAISettings() {
      const analyticsSection = document.getElementById('analytics-section');
      const backupSection = document.getElementById('backup-section');
      const aiSection = document.getElementById('ai-section');
      
      analyticsSection.style.display = 'none';
      backupSection.style.display = 'none';
      aiSection.style.display = 'block';
      
      loadAISettings();
    }

    // بارگذاری تحلیل‌ها
    function loadAnalytics() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      // محبوب‌ترین محصولات
      const popularProducts = products
        .sort((a, b) => (b.rating || 0) - (a.rating || 0))
        .slice(0, 5);
      
      document.getElementById('popularProducts').innerHTML = popularProducts.map(product => `
        <div style="display: flex; align-items: center; margin-bottom: 10px; padding: 10px; background: white; border-radius: 8px;">
          <img src="${product.image}" alt="${product.name}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 4px; margin-left: 10px;">
          <div>
            <div style="font-weight: 600;">${product.name}</div>
            <div style="font-size: 12px; color: #666;">⭐ ${product.rating || 0}</div>
          </div>
        </div>
      `).join('');
      
      // رفتار کاربران
      const userBehavior = {
        totalUsers: cartKeys.length,
        activeUsers: cartKeys.filter(key => {
          const cart = JSON.parse(localStorage.getItem(key)) || [];
          return cart.length > 0;
        }).length,
        avgCartValue: cartKeys.reduce((sum, key) => {
          const cart = JSON.parse(localStorage.getItem(key)) || [];
          return sum + cart.reduce((cartSum, item) => cartSum + (item.price * item.quantity), 0);
        }, 0) / Math.max(cartKeys.length, 1)
      };
      
      document.getElementById('userBehavior').innerHTML = `
        <div style="background: white; padding: 15px; border-radius: 8px;">
          <div style="margin-bottom: 10px;">
            <strong>کل کاربران:</strong> ${userBehavior.totalUsers}
          </div>
          <div style="margin-bottom: 10px;">
            <strong>کاربران فعال:</strong> ${userBehavior.activeUsers}
          </div>
          <div>
            <strong>میانگین ارزش سبد:</strong> ${userBehavior.avgCartValue.toLocaleString()} تومان
          </div>
        </div>
      `;
      
      // تحلیل درآمد
      const totalRevenue = cartKeys.reduce((sum, key) => {
        const cart = JSON.parse(localStorage.getItem(key)) || [];
        return sum + cart.reduce((cartSum, item) => cartSum + (item.price * item.quantity), 0);
      }, 0);
      
      const avgRevenue = totalRevenue / Math.max(cartKeys.length, 1);
      
      document.getElementById('revenueAnalysis').innerHTML = `
        <div style="background: white; padding: 15px; border-radius: 8px;">
          <div style="margin-bottom: 10px;">
            <strong>درآمد کل:</strong> ${totalRevenue.toLocaleString()} تومان
          </div>
          <div style="margin-bottom: 10px;">
            <strong>میانگین درآمد:</strong> ${avgRevenue.toLocaleString()} تومان
          </div>
          <div>
            <strong>نرخ تبدیل:</strong> ${((userBehavior.activeUsers / Math.max(userBehavior.totalUsers, 1)) * 100).toFixed(1)}%
          </div>
        </div>
      `;
    }

    // تولید گزارش
    function generateReport() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      const report = {
        date: new Date().toISOString(),
        totalProducts: products.length,
        totalUsers: cartKeys.length,
        totalRevenue: cartKeys.reduce((sum, key) => {
          const cart = JSON.parse(localStorage.getItem(key)) || [];
          return sum + cart.reduce((cartSum, item) => cartSum + (item.price * item.quantity), 0);
        }, 0),
        lowStockProducts: products.filter(p => p.stock <= 5).length,
        topProducts: products.sort((a, b) => (b.rating || 0) - (a.rating || 0)).slice(0, 5)
      };
      
      const reportText = `
گزارش فروشگاه کار آوال
تاریخ: ${new Date().toLocaleDateString('fa-IR')}

📊 آمار کلی:
- کل محصولات: ${report.totalProducts}
- کل کاربران: ${report.totalUsers}
- درآمد کل: ${report.totalRevenue.toLocaleString()} تومان
- محصولات کم‌موجود: ${report.lowStockProducts}

🏆 محصولات برتر:
${report.topProducts.map((p, i) => `${i + 1}. ${p.name} - ⭐ ${p.rating || 0}`).join('\n')}

📈 توصیه‌ها:
- افزایش موجودی محصولات کم‌موجود
- تبلیغ محصولات برتر
- بهبود تجربه کاربری
      `;
      
      // دانلود گزارش
      const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `report-${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      
      alert('گزارش با موفقیت تولید و دانلود شد!');
    }

    // صادرات تحلیل‌ها
    function exportAnalytics() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      const analyticsData = {
        products: products,
        users: cartKeys.map(key => {
          const cart = JSON.parse(localStorage.getItem(key)) || [];
          return {
            email: key.replace('cart_', ''),
            cart: cart,
            totalValue: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)
          };
        }),
        summary: {
          totalProducts: products.length,
          totalUsers: cartKeys.length,
          totalRevenue: cartKeys.reduce((sum, key) => {
            const cart = JSON.parse(localStorage.getItem(key)) || [];
            return sum + cart.reduce((cartSum, item) => cartSum + (item.price * item.quantity), 0);
          }, 0)
        }
      };
      
      const dataStr = JSON.stringify(analyticsData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `analytics-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      alert('داده‌های تحلیل با موفقیت صادر شد!');
    }

    // ایجاد پشتیبان
    function createBackup() {
      const backupData = {
        timestamp: new Date().toISOString(),
        products: JSON.parse(localStorage.getItem('products')) || [],
        recommendations: JSON.parse(localStorage.getItem('recommendations')) || [],
        menuSettings: JSON.parse(localStorage.getItem('menuSettings')) || {},
        displaySettings: JSON.parse(localStorage.getItem('displaySettings')) || {},
        allCarts: {}
      };
      
      // جمع‌آوری تمام سبدهای خرید
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      cartKeys.forEach(key => {
        backupData.allCarts[key] = JSON.parse(localStorage.getItem(key)) || [];
      });
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      // ذخیره در لیست پشتیبان‌ها
      const backups = JSON.parse(localStorage.getItem('backups')) || [];
      backups.push({
        name: `backup-${new Date().toLocaleDateString('fa-IR')}`,
        timestamp: new Date().toISOString(),
        size: dataStr.length
      });
      localStorage.setItem('backups', JSON.stringify(backups));
      
      logActivity('ایجاد پشتیبان', 'پشتیبان جدید ایجاد شد');
      alert('پشتیبان با موفقیت ایجاد شد!');
      loadBackupList();
    }

    // بارگذاری لیست پشتیبان‌ها
    function loadBackupList() {
      const backups = JSON.parse(localStorage.getItem('backups')) || [];
      const container = document.getElementById('backup-items');
      
      if (backups.length === 0) {
        container.innerHTML = '<p style="color: #666; text-align: center;">هیچ پشتیبانی یافت نشد</p>';
        return;
      }
      
      container.innerHTML = backups.map(backup => `
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: 8px; margin-bottom: 10px;">
          <div>
            <div style="font-weight: 600;">${backup.name}</div>
            <div style="font-size: 12px; color: #666;">${new Date(backup.timestamp).toLocaleDateString('fa-IR')}</div>
          </div>
          <div style="font-size: 12px; color: #666;">${(backup.size / 1024).toFixed(1)} KB</div>
        </div>
      `).join('');
    }

    // پاکسازی کامل داده‌ها
    function clearAllData() {
      if (confirm('⚠️ آیا مطمئن هستید که می‌خواهید تمام داده‌های فروشگاه را پاک کنید؟ این عمل غیرقابل بازگشت است!')) {
        if (confirm('🔴 این عمل تمام محصولات، سفارشات و تنظیمات را پاک می‌کند. آیا واقعاً مطمئن هستید؟')) {
          // پاک کردن تمام داده‌ها
          const keysToKeep = ['adminPassword', 'backups'];
          const allKeys = Object.keys(localStorage);
          allKeys.forEach(key => {
            if (!keysToKeep.includes(key)) {
              localStorage.removeItem(key);
            }
          });
          
          logActivity('پاکسازی داده‌ها', 'تمام داده‌های فروشگاه پاک شد');
          alert('تمام داده‌ها با موفقیت پاک شدند!');
          location.reload();
        }
      }
    }

    // بارگذاری تنظیمات هوشمند
    function loadAISettings() {
      const aiSettings = JSON.parse(localStorage.getItem('aiSettings')) || {
        recommendations: true,
        algorithm: 'popularity',
        autoAnalytics: true,
        analyticsFrequency: 'weekly',
        autoOptimization: false,
        autoStock: false
      };
      
      document.getElementById('ai-recommendations').checked = aiSettings.recommendations;
      document.getElementById('ai-algorithm').value = aiSettings.algorithm;
      document.getElementById('auto-analytics').checked = aiSettings.autoAnalytics;
      document.getElementById('analytics-frequency').value = aiSettings.analyticsFrequency;
      document.getElementById('auto-optimization').checked = aiSettings.autoOptimization;
      document.getElementById('auto-stock').checked = aiSettings.autoStock;
    }

    // ذخیره تنظیمات هوشمند
    function saveAISettings() {
      const aiSettings = {
        recommendations: document.getElementById('ai-recommendations').checked,
        algorithm: document.getElementById('ai-algorithm').value,
        autoAnalytics: document.getElementById('auto-analytics').checked,
        analyticsFrequency: document.getElementById('analytics-frequency').value,
        autoOptimization: document.getElementById('auto-optimization').checked,
        autoStock: document.getElementById('auto-stock').checked
      };
      
      localStorage.setItem('aiSettings', JSON.stringify(aiSettings));
      logActivity('ذخیره تنظیمات هوشمند', 'تنظیمات هوشمند به‌روزرسانی شد');
      alert('تنظیمات هوشمند با موفقیت ذخیره شد!');
    }

    // اجرای تحلیل هوشمند
    function runAIAnalysis() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      
      // تحلیل هوشمند محصولات
      const analysis = {
        lowStockAlert: products.filter(p => p.stock <= 3).length,
        highDemandProducts: products.filter(p => p.rating >= 4.5).length,
        priceOptimization: products.filter(p => p.discount === 0 && p.stock > 10).length,
        recommendations: []
      };
      
      // تولید توصیه‌های هوشمند
      if (analysis.lowStockAlert > 0) {
        analysis.recommendations.push(`⚠️ ${analysis.lowStockAlert} محصول موجودی کم دارد`);
      }
      
      if (analysis.highDemandProducts > 0) {
        analysis.recommendations.push(`⭐ ${analysis.highDemandProducts} محصول محبوب برای تبلیغ`);
      }
      
      if (analysis.priceOptimization > 0) {
        analysis.recommendations.push(`💰 ${analysis.priceOptimization} محصول برای تخفیف مناسب است`);
      }
      
      // نمایش نتایج
      const results = `
🔍 نتایج تحلیل هوشمند:

${analysis.recommendations.join('\n')}

📊 آمار کلی:
- محصولات کم‌موجود: ${analysis.lowStockAlert}
- محصولات محبوب: ${analysis.highDemandProducts}
- محصولات قابل تخفیف: ${analysis.priceOptimization}
      `;
      
      alert(results);
      logActivity('تحلیل هوشمند', 'تحلیل هوشمند اجرا شد');
    }

    // تغییر رمز عبور ادمین
    function changeAdminPassword() {
      const newPassword = document.getElementById('new-admin-password').value;
      if (newPassword.length < 6) {
        alert('رمز عبور باید حداقل 6 کاراکتر باشد!');
        return;
      }
      
      localStorage.setItem('adminPassword', newPassword);
      document.getElementById('new-admin-password').value = '';
      logActivity('تغییر رمز عبور', 'رمز عبور ادمین تغییر کرد');
      alert('رمز عبور با موفقیت تغییر کرد!');
    }

    // بارگذاری لاگ فعالیت‌ها
    function loadActivityLog() {
      const activities = JSON.parse(localStorage.getItem('activities')) || [];
      const container = document.getElementById('activity-log');
      
      if (activities.length === 0) {
        container.innerHTML = '<p style="color: #666; text-align: center;">هیچ فعالیتی ثبت نشده</p>';
        return;
      }
      
      container.innerHTML = activities.slice(-10).reverse().map(activity => `
        <div class="activity-item">
          <div class="activity-time">${new Date(activity.timestamp).toLocaleString('fa-IR')}</div>
          <div class="activity-action">${activity.action}</div>
          <div class="activity-user">${activity.details}</div>
        </div>
      `).join('');
    }

    // ثبت فعالیت
    function logActivity(action, details) {
      const activities = JSON.parse(localStorage.getItem('activities')) || [];
      activities.push({
        timestamp: new Date().toISOString(),
        action: action,
        details: details
      });
      
      // نگه داشتن فقط 100 فعالیت آخر
      if (activities.length > 100) {
        activities.splice(0, activities.length - 100);
      }
      
      localStorage.setItem('activities', JSON.stringify(activities));
    }

    // صادرات لاگ فعالیت‌ها
    function exportActivityLog() {
      const activities = JSON.parse(localStorage.getItem('activities')) || [];
      const logText = activities.map(activity => 
        `${new Date(activity.timestamp).toLocaleString('fa-IR')} - ${activity.action}: ${activity.details}`
      ).join('\n');
      
      const blob = new Blob([logText], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `activity-log-${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      
      alert('لاگ فعالیت‌ها با موفقیت صادر شد!');
    }

    // بارگذاری تنظیمات پیشرفته
    function loadAdvancedSettings() {
      const advancedSettings = JSON.parse(localStorage.getItem('advancedSettings')) || {
        theme: 'default',
        fontSize: 'medium',
        emailNotifications: true,
        browserNotifications: true,
        soundNotifications: false,
        mobileOptimization: true,
        touchGestures: true
      };
      
      document.getElementById('theme-selector').value = advancedSettings.theme;
      document.getElementById('font-size').value = advancedSettings.fontSize;
      document.getElementById('email-notifications').checked = advancedSettings.emailNotifications;
      document.getElementById('browser-notifications').checked = advancedSettings.browserNotifications;
      document.getElementById('sound-notifications').checked = advancedSettings.soundNotifications;
      document.getElementById('mobile-optimization').checked = advancedSettings.mobileOptimization;
      document.getElementById('touch-gestures').checked = advancedSettings.touchGestures;
    }

    // ذخیره تنظیمات پیشرفته
    function saveAdvancedSettings() {
      const advancedSettings = {
        theme: document.getElementById('theme-selector').value,
        fontSize: document.getElementById('font-size').value,
        emailNotifications: document.getElementById('email-notifications').checked,
        browserNotifications: document.getElementById('browser-notifications').checked,
        soundNotifications: document.getElementById('sound-notifications').checked,
        mobileOptimization: document.getElementById('mobile-optimization').checked,
        touchGestures: document.getElementById('touch-gestures').checked
      };
      
      localStorage.setItem('advancedSettings', JSON.stringify(advancedSettings));
      logActivity('ذخیره تنظیمات پیشرفته', 'تنظیمات پیشرفته به‌روزرسانی شد');
      alert('تنظیمات پیشرفته با موفقیت ذخیره شد!');
    }

    // بازنشانی تنظیمات پیشرفته
    function resetAdvancedSettings() {
      if (confirm('آیا مطمئن هستید که می‌خواهید تنظیمات پیشرفته را به حالت پیش‌فرض بازگردانید؟')) {
        localStorage.removeItem('advancedSettings');
        loadAdvancedSettings();
        alert('تنظیمات پیشرفته به حالت پیش‌فرض بازگردانده شد!');
      }
    }

    // به‌روزرسانی آمار پیشرفته
    function updateAdvancedStats() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      // محاسبه آمار پیشرفته
      const totalRevenue = cartKeys.reduce((sum, key) => {
        const cart = JSON.parse(localStorage.getItem(key)) || [];
        return sum + cart.reduce((cartSum, item) => cartSum + (item.price * item.quantity), 0);
      }, 0);
      
      const avgRating = products.length > 0 ? 
        (products.reduce((sum, p) => sum + (p.rating || 0), 0) / products.length).toFixed(1) : 0;
      
      const activeUsers = cartKeys.filter(key => {
        const cart = JSON.parse(localStorage.getItem(key)) || [];
        return cart.length > 0;
      }).length;
      
      // به‌روزرسانی نمایش
      document.getElementById('activeUsers').textContent = activeUsers;
      document.getElementById('avgRating').textContent = avgRating;
      
      // به‌روزرسانی روندها
      updateTrends();
    }

    // به‌روزرسانی روندها
    function updateTrends() {
      const trends = JSON.parse(localStorage.getItem('trends')) || {
        products: '+12%',
        orders: '+8%',
        revenue: '+15%',
        users: '+5%',
        rating: '+0.2'
      };
      
      document.getElementById('productsTrend').textContent = `↗️ ${trends.products}`;
      document.getElementById('ordersTrend').textContent = `↗️ ${trends.orders}`;
      document.getElementById('revenueTrend').textContent = `↗️ ${trends.revenue}`;
      document.getElementById('usersTrend').textContent = `↗️ ${trends.users}`;
      document.getElementById('ratingTrend').textContent = `↗️ ${trends.rating}`;
      
      // اضافه کردن کلاس‌های رنگی
      document.getElementById('productsTrend').className = 'stat-trend positive';
      document.getElementById('ordersTrend').className = 'stat-trend positive';
      document.getElementById('revenueTrend').className = 'stat-trend positive';
      document.getElementById('usersTrend').className = 'stat-trend positive';
      document.getElementById('ratingTrend').className = 'stat-trend positive';
      document.getElementById('stockTrend').className = 'stat-trend warning';
    }

    // به‌روزرسانی تابع آمار
    const originalUpdateStats = updateStats;
    updateStats = function() {
      originalUpdateStats();
      updateAdvancedStats();
    };

    // ===== قابلیت‌های جدید خفن =====

    // سیستم اعلان‌ها
    let notifications = JSON.parse(localStorage.getItem('notifications')) || [];
    let notificationCenterVisible = false;

    function toggleNotifications() {
      const center = document.getElementById('notification-center');
      notificationCenterVisible = !notificationCenterVisible;
      center.style.display = notificationCenterVisible ? 'block' : 'none';
      
      if (notificationCenterVisible) {
        loadNotifications();
      }
    }

    function addNotification(title, message, type = 'info') {
      const notification = {
        id: Date.now(),
        title: title,
        message: message,
        type: type,
        timestamp: new Date().toISOString(),
        read: false
      };
      
      notifications.unshift(notification);
      
      // نگه داشتن فقط 50 اعلان آخر
      if (notifications.length > 50) {
        notifications = notifications.slice(0, 50);
      }
      
      localStorage.setItem('notifications', JSON.stringify(notifications));
      
      // نمایش اعلان فوری
      showToastNotification(title, message, type);
    }

    function loadNotifications() {
      const container = document.getElementById('notification-list');
      container.innerHTML = '';
      
      if (notifications.length === 0) {
        container.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">هیچ اعلانی موجود نیست</div>';
        return;
      }
      
      notifications.forEach(notification => {
        const item = document.createElement('div');
        item.className = `notification-item ${notification.read ? '' : 'unread'}`;
        item.onclick = () => markNotificationAsRead(notification.id);
        
        const typeIcon = {
          'info': 'ℹ️',
          'success': '✅',
          'warning': '⚠️',
          'error': '❌'
        }[notification.type] || 'ℹ️';
        
        item.innerHTML = `
          <div style="font-weight: 600;">${typeIcon} ${notification.title}</div>
          <div style="color: #666; margin-top: 5px;">${notification.message}</div>
          <div class="notification-time">${new Date(notification.timestamp).toLocaleString('fa-IR')}</div>
        `;
        
        container.appendChild(item);
      });
    }

    function markNotificationAsRead(id) {
      const notification = notifications.find(n => n.id === id);
      if (notification) {
        notification.read = true;
        localStorage.setItem('notifications', JSON.stringify(notifications));
        loadNotifications();
      }
    }

    function showToastNotification(title, message, type) {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        left: 20px;
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        z-index: 1001;
        max-width: 300px;
        border-right: 4px solid ${type === 'success' ? '#27ae60' : type === 'warning' ? '#f39c12' : type === 'error' ? '#e74c3c' : '#3498db'};
      `;
      
      toast.innerHTML = `
        <div style="font-weight: 600; margin-bottom: 5px;">${title}</div>
        <div style="color: #666; font-size: 14px;">${message}</div>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(-100%)';
        setTimeout(() => document.body.removeChild(toast), 300);
      }, 3000);
    }

    // نمایش قابلیت‌های پیشرفته
    function showAdvancedFeatures() {
      hideAllSections();
      document.getElementById('advanced-features-section').style.display = 'block';
      loadUsersList();
      addNotification('قابلیت‌های پیشرفته', 'بخش قابلیت‌های پیشرفته باز شد', 'info');
    }

    function hideAllSections() {
      const sections = ['analytics-section', 'backup-section', 'ai-section', 'advanced-features-section', 'forecast-section', 'security-section'];
      sections.forEach(id => {
        const section = document.getElementById(id);
        if (section) section.style.display = 'none';
      });
    }

    // جستجوی پیشرفته
    function performAdvancedSearch() {
      const searchTerm = document.getElementById('advanced-search-input').value;
      const category = document.getElementById('category-filter').value;
      const minPrice = document.getElementById('min-price').value;
      const maxPrice = document.getElementById('max-price').value;
      const stockFilter = document.getElementById('stock-filter').value;
      
      const products = JSON.parse(localStorage.getItem('products')) || [];
      let filteredProducts = products;
      
      // فیلتر بر اساس جستجو
      if (searchTerm) {
        filteredProducts = filteredProducts.filter(p => 
          p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          p.category.toLowerCase().includes(searchTerm.toLowerCase()) ||
          (p.description && p.description.toLowerCase().includes(searchTerm.toLowerCase()))
        );
      }
      
      // فیلتر بر اساس دسته‌بندی
      if (category) {
        filteredProducts = filteredProducts.filter(p => p.category === category);
      }
      
      // فیلتر بر اساس قیمت
      if (minPrice) {
        filteredProducts = filteredProducts.filter(p => p.price >= parseInt(minPrice));
      }
      if (maxPrice) {
        filteredProducts = filteredProducts.filter(p => p.price <= parseInt(maxPrice));
      }
      
      // فیلتر بر اساس موجودی
      if (stockFilter) {
        switch(stockFilter) {
          case 'in-stock':
            filteredProducts = filteredProducts.filter(p => p.stock > 5);
            break;
          case 'low-stock':
            filteredProducts = filteredProducts.filter(p => p.stock > 0 && p.stock <= 5);
            break;
          case 'out-of-stock':
            filteredProducts = filteredProducts.filter(p => p.stock === 0);
            break;
        }
      }
      
      // نمایش نتایج
      displaySearchResults(filteredProducts);
      addNotification('جستجوی پیشرفته', `${filteredProducts.length} محصول یافت شد`, 'success');
    }

    function displaySearchResults(products) {
      const tbody = document.getElementById('products-tbody');
      tbody.innerHTML = '';
      
      if (products.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px;">هیچ محصولی یافت نشد</td></tr>';
        return;
      }
      
      products.forEach(product => {
        const row = document.createElement('tr');
        
        const badges = [];
        if (product.discount > 0) badges.push(`<span class="badge discount">${product.discount}% تخفیف</span>`);
        if (product.isNew) badges.push('<span class="badge new">جدید</span>');
        if (product.isPopular) badges.push('<span class="badge popular">محبوب</span>');
        
        const stockClass = product.stock > 0 ? 'in-stock' : 'out-of-stock';
        const stockText = product.stock > 0 ? `${product.stock} عدد` : 'ناموجود';

        row.innerHTML = `
          <td><img src="${product.image}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/60x60?text=تصویر'" /></td>
          <td>${product.name}</td>
          <td>${product.category || 'عمومی'}</td>
          <td>${product.price.toLocaleString()} تومان</td>
          <td><span class="stock-status ${stockClass}">${stockText}</span></td>
          <td>${product.rating ? product.rating.toFixed(1) : '0.0'} ⭐</td>
          <td>${badges.join(' ')}</td>
          <td>
            <button class="btn btn-warning" onclick="editProduct(${product.id})">ویرایش</button>
            <button class="btn btn-danger" onclick="deleteProduct(${product.id})">حذف</button>
            <button class="btn btn-success" onclick="addToRecommendations(${product.id})">پیشنهاد</button>
          </td>
        `;
        
        tbody.appendChild(row);
      });
    }

    function clearAdvancedSearch() {
      document.getElementById('advanced-search-input').value = '';
      document.getElementById('category-filter').value = '';
      document.getElementById('min-price').value = '';
      document.getElementById('max-price').value = '';
      document.getElementById('stock-filter').value = '';
      loadProducts();
    }

    // عملیات گروهی
    let bulkSelectionMode = false;
    let selectedProducts = [];

    function toggleBulkSelection() {
      bulkSelectionMode = !bulkSelectionMode;
      const bulkActions = document.getElementById('bulk-actions');
      
      if (bulkSelectionMode) {
        bulkActions.classList.add('active');
        addCheckboxesToProducts();
        addNotification('انتخاب گروهی', 'حالت انتخاب گروهی فعال شد', 'info');
      } else {
        bulkActions.classList.remove('active');
        removeCheckboxesFromProducts();
        selectedProducts = [];
        updateBulkSelectionInfo();
      }
    }

    function addCheckboxesToProducts() {
      const rows = document.querySelectorAll('#products-tbody tr');
      rows.forEach((row, index) => {
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'bulk-checkbox';
        checkbox.onchange = function() {
          if (this.checked) {
            selectedProducts.push(index);
          } else {
            selectedProducts = selectedProducts.filter(i => i !== index);
          }
          updateBulkSelectionInfo();
        };
        
        const firstCell = row.querySelector('td');
        firstCell.insertBefore(checkbox, firstCell.firstChild);
      });
    }

    function removeCheckboxesFromProducts() {
      const checkboxes = document.querySelectorAll('.bulk-checkbox');
      checkboxes.forEach(checkbox => checkbox.remove());
    }

    function updateBulkSelectionInfo() {
      document.getElementById('bulk-selection-info').textContent = `${selectedProducts.length} محصول انتخاب شده`;
    }

    function bulkEdit() {
      if (selectedProducts.length === 0) {
        alert('لطفاً ابتدا محصولاتی را انتخاب کنید');
        return;
      }
      
      const discount = prompt('درصد تخفیف گروهی را وارد کنید (0-100):');
      if (discount === null) return;
      
      const discountValue = parseInt(discount);
      if (isNaN(discountValue) || discountValue < 0 || discountValue > 100) {
        alert('لطفاً عدد معتبری وارد کنید');
        return;
      }
      
      const products = JSON.parse(localStorage.getItem('products')) || [];
      selectedProducts.forEach(index => {
        if (products[index]) {
          products[index].discount = discountValue;
        }
      });
      
      localStorage.setItem('products', JSON.stringify(products));
      loadProducts();
      addNotification('ویرایش گروهی', `${selectedProducts.length} محصول ویرایش شد`, 'success');
    }

    function bulkDelete() {
      if (selectedProducts.length === 0) {
        alert('لطفاً ابتدا محصولاتی را انتخاب کنید');
        return;
      }
      
      if (!confirm(`آیا از حذف ${selectedProducts.length} محصول اطمینان دارید؟`)) return;
      
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const productsToDelete = selectedProducts.map(index => products[index]).filter(p => p);
      
      const filteredProducts = products.filter(p => !productsToDelete.includes(p));
      localStorage.setItem('products', JSON.stringify(filteredProducts));
      
      loadProducts();
      addNotification('حذف گروهی', `${selectedProducts.length} محصول حذف شد`, 'warning');
      selectedProducts = [];
      updateBulkSelectionInfo();
    }

    function bulkExport() {
      if (selectedProducts.length === 0) {
        alert('لطفاً ابتدا محصولاتی را انتخاب کنید');
        return;
      }
      
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const selectedProductsData = selectedProducts.map(index => products[index]).filter(p => p);
      
      const dataStr = JSON.stringify(selectedProductsData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `selected-products-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      addNotification('صادرات گروهی', `${selectedProducts.length} محصول صادر شد`, 'success');
    }

    function bulkDiscount() {
      if (selectedProducts.length === 0) {
        alert('لطفاً ابتدا محصولاتی را انتخاب کنید');
        return;
      }
      
      const discount = prompt('درصد تخفیف گروهی را وارد کنید (0-100):');
      if (discount === null) return;
      
      const discountValue = parseInt(discount);
      if (isNaN(discountValue) || discountValue < 0 || discountValue > 100) {
        alert('لطفاً عدد معتبری وارد کنید');
        return;
      }
      
      const products = JSON.parse(localStorage.getItem('products')) || [];
      selectedProducts.forEach(index => {
        if (products[index]) {
          products[index].discount = discountValue;
        }
      });
      
      localStorage.setItem('products', JSON.stringify(products));
      loadProducts();
      addNotification('تخفیف گروهی', `${selectedProducts.length} محصول تخفیف گرفت`, 'success');
    }

    // مدیریت کاربران
    function loadUsersList() {
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      const container = document.getElementById('users-list');
      
      if (cartKeys.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">هیچ کاربری یافت نشد</p>';
        return;
      }
      
      container.innerHTML = '';
      cartKeys.forEach((cartKey, index) => {
        const userEmail = cartKey.replace('cart_', '');
        const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const totalValue = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        const userCard = document.createElement('div');
        userCard.className = 'user-card';
        userCard.innerHTML = `
          <div class="user-avatar">${userEmail.charAt(0).toUpperCase()}</div>
          <div class="user-info">
            <div style="font-weight: 600;">${userEmail}</div>
            <div style="font-size: 12px; color: #666;">
              ${totalItems} محصول | ${totalValue.toLocaleString()} تومان
            </div>
            <div style="font-size: 11px; color: #999;">
              آخرین فعالیت: ${new Date().toLocaleDateString('fa-IR')}
            </div>
          </div>
          <div class="user-actions">
            <button class="btn btn-primary" onclick="viewUserDetails('${userEmail}')" style="font-size: 12px;">مشاهده</button>
            <button class="btn btn-warning" onclick="exportUserData('${userEmail}')" style="font-size: 12px;">صادرات</button>
            <button class="btn btn-danger" onclick="deleteUserData('${userEmail}')" style="font-size: 12px;">حذف</button>
          </div>
        `;
        
        container.appendChild(userCard);
      });
    }

    function refreshUsersList() {
      loadUsersList();
      addNotification('بروزرسانی کاربران', 'لیست کاربران بروزرسانی شد', 'success');
    }

    function viewUserDetails(userEmail) {
      const cartKey = `cart_${userEmail}`;
      const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
      
      const details = `
کاربر: ${userEmail}
تعداد محصولات: ${cart.length}
مبلغ کل: ${cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toLocaleString()} تومان

محصولات:
${cart.map(item => `- ${item.name} (${item.quantity} عدد)`).join('\n')}
      `;
      
      alert(details);
    }

    function exportUserData(userEmail) {
      const cartKey = `cart_${userEmail}`;
      const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
      
      const userData = {
        email: userEmail,
        cart: cart,
        totalItems: cart.reduce((sum, item) => sum + item.quantity, 0),
        totalValue: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
        exportDate: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(userData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `user-${userEmail}-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      addNotification('صادرات کاربر', `داده‌های کاربر ${userEmail} صادر شد`, 'success');
    }

    function deleteUserData(userEmail) {
      if (!confirm(`آیا از حذف داده‌های کاربر ${userEmail} اطمینان دارید؟`)) return;
      
      const cartKey = `cart_${userEmail}`;
      localStorage.removeItem(cartKey);
      
      loadUsersList();
      addNotification('حذف کاربر', `داده‌های کاربر ${userEmail} حذف شد`, 'warning');
    }

    function exportUsersData() {
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      const usersData = cartKeys.map(cartKey => {
        const userEmail = cartKey.replace('cart_', '');
        const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
        return {
          email: userEmail,
          cart: cart,
          totalItems: cart.reduce((sum, item) => sum + item.quantity, 0),
          totalValue: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)
        };
      });
      
      const dataStr = JSON.stringify(usersData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `all-users-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      addNotification('صادرات کاربران', `${usersData.length} کاربر صادر شد`, 'success');
    }

    // واردات و صادرات
    function exportProducts() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const includeImages = document.getElementById('export-images').checked;
      const includeDescriptions = document.getElementById('export-descriptions').checked;
      const includeStats = document.getElementById('export-stats').checked;
      
      let exportData = products;
      
      if (!includeImages) {
        exportData = exportData.map(p => ({ ...p, image: undefined }));
      }
      
      if (!includeDescriptions) {
        exportData = exportData.map(p => ({ ...p, description: undefined }));
      }
      
      if (includeStats) {
        exportData = {
          products: exportData,
          stats: {
            totalProducts: products.length,
            exportDate: new Date().toISOString(),
            categories: [...new Set(products.map(p => p.category))],
            totalValue: products.reduce((sum, p) => sum + p.price, 0)
          }
        };
      }
      
      const dataStr = JSON.stringify(exportData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `products-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      addNotification('صادرات محصولات', `${products.length} محصول صادر شد`, 'success');
    }

    function exportProductsCSV() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      
      const csvHeader = 'نام,قیمت,دسته‌بندی,موجودی,امتیاز,تخفیف,توضیحات\n';
      const csvData = products.map(p => 
        `"${p.name}","${p.price}","${p.category || ''}","${p.stock}","${p.rating || 0}","${p.discount || 0}","${p.description || ''}"`
      ).join('\n');
      
      const csvContent = csvHeader + csvData;
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `products-${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(url);
      
      addNotification('صادرات CSV', `${products.length} محصول به فرمت CSV صادر شد`, 'success');
    }

    function handleFileImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          let data;
          if (file.name.endsWith('.json')) {
            data = JSON.parse(e.target.result);
          } else if (file.name.endsWith('.csv')) {
            data = parseCSV(e.target.result);
          } else {
            alert('فرمت فایل پشتیبانی نمی‌شود');
            return;
          }
          
          importProducts(data);
        } catch (error) {
          alert('خطا در خواندن فایل: ' + error.message);
        }
      };
      reader.readAsText(file);
    }

    function parseCSV(csvText) {
      const lines = csvText.split('\n');
      const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
      const products = [];
      
      for (let i = 1; i < lines.length; i++) {
        if (lines[i].trim() === '') continue;
        
        const values = lines[i].split(',').map(v => v.replace(/"/g, ''));
        const product = {
          id: Date.now() + i,
          name: values[0] || '',
          price: parseInt(values[1]) || 0,
          category: values[2] || 'عمومی',
          stock: parseInt(values[3]) || 0,
          rating: parseFloat(values[4]) || 0,
          discount: parseInt(values[5]) || 0,
          description: values[6] || '',
          image: 'https://via.placeholder.com/300x300?text=محصول',
          isNew: false,
          isPopular: false
        };
        products.push(product);
      }
      
      return products;
    }

    function importProducts(products) {
      if (!Array.isArray(products)) {
        if (products.products) {
          products = products.products;
        } else {
          alert('فرمت داده نامعتبر است');
          return;
        }
      }
      
      const existingProducts = JSON.parse(localStorage.getItem('products')) || [];
      const newProducts = products.map(p => ({
        ...p,
        id: Date.now() + Math.random()
      }));
      
      const allProducts = [...existingProducts, ...newProducts];
      localStorage.setItem('products', JSON.stringify(allProducts));
      
      loadProducts();
      updateStats();
      addNotification('واردات محصولات', `${newProducts.length} محصول وارد شد`, 'success');
    }

    // پیش‌بینی فروش
    function generateForecast() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      // محاسبه آمار فعلی
      const currentRevenue = cartKeys.reduce((sum, key) => {
        const cart = JSON.parse(localStorage.getItem(key)) || [];
        return sum + cart.reduce((cartSum, item) => cartSum + (item.price * item.quantity), 0);
      }, 0);
      
      const currentOrders = cartKeys.length;
      
      // پیش‌بینی ساده (افزایش 15% ماهانه)
      const forecastRevenue = Math.round(currentRevenue * 1.15);
      const forecastOrders = Math.round(currentOrders * 1.15);
      const growthRate = 15;
      const conversionRate = products.length > 0 ? Math.round((currentOrders / products.length) * 100) : 0;
      
      // به‌روزرسانی نمایش
      document.getElementById('forecast-revenue').textContent = forecastRevenue.toLocaleString();
      document.getElementById('forecast-orders').textContent = forecastOrders;
      document.getElementById('growth-rate').textContent = `${growthRate}%`;
      document.getElementById('conversion-rate').textContent = `${conversionRate}%`;
      
      // نمایش نمودار ساده
      const chart = document.getElementById('forecast-chart');
      chart.innerHTML = `
        <div style="text-align: center;">
          <div style="font-size: 24px; color: #667eea; margin-bottom: 10px;">📈</div>
          <div style="font-size: 16px; color: #333; margin-bottom: 5px;">درآمد فعلی: ${currentRevenue.toLocaleString()} تومان</div>
          <div style="font-size: 16px; color: #27ae60; margin-bottom: 5px;">درآمد پیش‌بینی شده: ${forecastRevenue.toLocaleString()} تومان</div>
          <div style="font-size: 14px; color: #666;">نرخ رشد: ${growthRate}%</div>
        </div>
      `;
      
      addNotification('پیش‌بینی فروش', 'پیش‌بینی فروش تولید شد', 'success');
    }

    function exportForecast() {
      const forecastData = {
        date: new Date().toISOString(),
        currentRevenue: parseInt(document.getElementById('forecast-revenue').textContent.replace(/,/g, '')),
        forecastOrders: parseInt(document.getElementById('forecast-orders').textContent),
        growthRate: document.getElementById('growth-rate').textContent,
        conversionRate: document.getElementById('conversion-rate').textContent
      };
      
      const dataStr = JSON.stringify(forecastData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `forecast-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      addNotification('صادرات پیش‌بینی', 'گزارش پیش‌بینی صادر شد', 'success');
    }

    // هشدارهای موجودی
    function loadInventoryAlerts() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const lowStockProducts = products.filter(p => p.stock <= 5 && p.stock > 0);
      const outOfStockProducts = products.filter(p => p.stock === 0);
      
      const container = document.getElementById('low-stock-alerts');
      container.innerHTML = '';
      
      if (lowStockProducts.length === 0 && outOfStockProducts.length === 0) {
        container.innerHTML = '<p style="color: #27ae60;">✅ تمام محصولات موجودی کافی دارند</p>';
        return;
      }
      
      if (lowStockProducts.length > 0) {
        container.innerHTML += '<h5 style="color: #f39c12; margin-bottom: 10px;">⚠️ محصولات کم‌موجود:</h5>';
        lowStockProducts.forEach(product => {
          container.innerHTML += `
            <div style="padding: 10px; background: #fff3cd; border-radius: 5px; margin-bottom: 5px;">
              <strong>${product.name}</strong> - موجودی: ${product.stock} عدد
            </div>
          `;
        });
      }
      
      if (outOfStockProducts.length > 0) {
        container.innerHTML += '<h5 style="color: #e74c3c; margin-bottom: 10px;">❌ محصولات ناموجود:</h5>';
        outOfStockProducts.forEach(product => {
          container.innerHTML += `
            <div style="padding: 10px; background: #f8d7da; border-radius: 5px; margin-bottom: 5px;">
              <strong>${product.name}</strong> - موجودی: 0 عدد
            </div>
          `;
        });
      }
    }

    // امنیت و نظارت
    function runSecurityScan() {
      const scanResults = {
        passwordStrength: 'قوی',
        activityLogs: 'فعال',
        suspiciousActivity: 'هیچ فعالیت مشکوکی یافت نشد',
        recommendations: [
          'رمز عبور را به‌طور منظم تغییر دهید',
          'لاگ‌های فعالیت را بررسی کنید',
          'دسترسی‌های غیرضروری را محدود کنید'
        ]
      };
      
      const results = `
🔍 نتایج اسکن امنیتی:

✅ رمز عبور: ${scanResults.passwordStrength}
✅ لاگ فعالیت‌ها: ${scanResults.activityLogs}
✅ فعالیت مشکوک: ${scanResults.suspiciousActivity}

📋 توصیه‌ها:
${scanResults.recommendations.map(r => `• ${r}`).join('\n')}
      `;
      
      alert(results);
      addNotification('اسکن امنیتی', 'اسکن امنیتی تکمیل شد', 'success');
    }

    function viewDetailedLogs() {
      const activities = JSON.parse(localStorage.getItem('activities')) || [];
      
      if (activities.length === 0) {
        alert('هیچ لاگ فعالیتی موجود نیست');
        return;
      }
      
      const logsText = activities.map(activity => 
        `${new Date(activity.timestamp).toLocaleString('fa-IR')} - ${activity.action}: ${activity.details}`
      ).join('\n');
      
      const blob = new Blob([logsText], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `detailed-logs-${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(url);
      
      addNotification('لاگ‌های تفصیلی', 'لاگ‌های تفصیلی دانلود شد', 'success');
    }

    function clearSecurityAlerts() {
      document.getElementById('security-alerts').innerHTML = '<p style="color: #27ae60;">✅ هیچ هشداری موجود نیست</p>';
      addNotification('پاک کردن هشدارها', 'هشدارهای امنیتی پاک شدند', 'success');
    }

    // به‌روزرسانی آمار امنیت
    function updateSecurityStats() {
      const activities = JSON.parse(localStorage.getItem('activities')) || [];
      const today = new Date().toDateString();
      
      const todayLogins = activities.filter(a => 
        a.action.includes('ورود') && new Date(a.timestamp).toDateString() === today
      ).length;
      
      const adminActions = activities.filter(a => 
        a.action.includes('ادمین') || a.action.includes('محصول') || a.action.includes('تنظیمات')
      ).length;
      
      const lastLogin = activities.length > 0 ? 
        new Date(activities[activities.length - 1].timestamp).toLocaleString('fa-IR') : 'نامشخص';
      
      document.getElementById('today-logins').textContent = todayLogins;
      document.getElementById('admin-actions').textContent = adminActions;
      document.getElementById('last-login').textContent = lastLogin;
    }

    // نمایش بخش‌های مختلف
    function showForecastSection() {
      hideAllSections();
      document.getElementById('forecast-section').style.display = 'block';
      generateForecast();
      loadInventoryAlerts();
      addNotification('پیش‌بینی فروش', 'بخش پیش‌بینی فروش باز شد', 'info');
    }

    function showSecuritySection() {
      hideAllSections();
      document.getElementById('security-section').style.display = 'block';
      updateSecurityStats();
      addNotification('داشبورد امنیت', 'بخش امنیت و نظارت باز شد', 'info');
    }

    // اضافه کردن دکمه‌های جدید به هدر
    document.addEventListener('DOMContentLoaded', function() {
      const headerButtons = document.querySelector('.admin-header div');
      
      // اضافه کردن دکمه پیش‌بینی فروش
      const forecastBtn = document.createElement('button');
      forecastBtn.className = 'btn';
      forecastBtn.style.cssText = 'background: linear-gradient(135deg, #ffa502, #ff6348); color: white;';
      forecastBtn.onclick = showForecastSection;
      forecastBtn.innerHTML = '📈 پیش‌بینی فروش';
      headerButtons.appendChild(forecastBtn);
      
      // اضافه کردن دکمه امنیت
      const securityBtn = document.createElement('button');
      securityBtn.className = 'btn';
      securityBtn.style.cssText = 'background: linear-gradient(135deg, #e74c3c, #c0392b); color: white;';
      securityBtn.onclick = showSecuritySection;
      securityBtn.innerHTML = '🔒 امنیت و نظارت';
      headerButtons.appendChild(securityBtn);
    });

    // اضافه کردن اعلان‌های خودکار
    setInterval(() => {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const lowStockProducts = products.filter(p => p.stock <= 3 && p.stock > 0);
      
      if (lowStockProducts.length > 0 && Math.random() < 0.1) { // 10% شانس
        addNotification('هشدار موجودی', `${lowStockProducts.length} محصول موجودی کم دارد`, 'warning');
      }
    }, 300000); // هر 5 دقیقه

    // اعلان خوش‌آمدگویی
    setTimeout(() => {
      addNotification('خوش‌آمدید!', 'پنل مدیریت با قابلیت‌های جدید آماده است', 'success');
    }, 2000);

    // ===== سیستم اعلان‌های کاربران =====
    
    let selectedNotificationType = 'info';
    let selectedUsers = [];
    let userNotifications = JSON.parse(localStorage.getItem('userNotifications')) || [];
    let scheduledNotifications = JSON.parse(localStorage.getItem('scheduledNotifications')) || [];

    // نمایش بخش اعلان‌های کاربران
    function showUserNotifications() {
      hideAllSections();
      document.getElementById('user-notifications-section').style.display = 'block';
      loadUserList();
      loadNotificationHistory();
      loadScheduledNotifications();
      addNotification('اعلان‌های کاربران', 'بخش اعلان‌های کاربران باز شد', 'info');
    }

    // انتخاب نوع اعلان
    function selectNotificationType(type, element) {
      selectedNotificationType = type;
      
      // حذف کلاس active از همه
      document.querySelectorAll('.notification-type').forEach(el => {
        el.classList.remove('active');
      });
      
      // اضافه کردن کلاس active به انتخاب شده
      element.classList.add('active');
      
      updateMessagePreview();
    }

    // بارگذاری لیست کاربران
    function loadUserList() {
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      const container = document.getElementById('user-selector');
      
      container.innerHTML = '';
      
      if (cartKeys.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">هیچ کاربری یافت نشد</p>';
        return;
      }
      
      cartKeys.forEach(cartKey => {
        const userEmail = cartKey.replace('cart_', '');
        const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        
        const userItem = document.createElement('div');
        userItem.className = 'user-item';
        userItem.innerHTML = `
          <input type="checkbox" onchange="toggleUserSelection('${userEmail}', this.checked)">
          <span>${userEmail}</span>
          <small style="color: #666;">(${totalItems} محصول)</small>
        `;
        
        container.appendChild(userItem);
      });
    }

    // انتخاب/لغو انتخاب کاربر
    function toggleUserSelection(userEmail, selected) {
      if (selected) {
        if (!selectedUsers.includes(userEmail)) {
          selectedUsers.push(userEmail);
        }
      } else {
        selectedUsers = selectedUsers.filter(email => email !== userEmail);
      }
      
      updateMessagePreview();
    }

    // انتخاب همه کاربران
    function selectAllUsers() {
      const allKeys = Object.keys(localStorage);
      const cartKeys = allKeys.filter(key => key.startsWith('cart_'));
      
      selectedUsers = cartKeys.map(key => key.replace('cart_', ''));
      
      // انتخاب همه checkbox ها
      document.querySelectorAll('#user-selector input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = true;
      });
      
      updateMessagePreview();
      addNotification('انتخاب کاربران', `${selectedUsers.length} کاربر انتخاب شد`, 'success');
    }

    // پاک کردن انتخاب کاربران
    function clearUserSelection() {
      selectedUsers = [];
      
      // پاک کردن همه checkbox ها
      document.querySelectorAll('#user-selector input[type="checkbox"]').forEach(checkbox => {
        checkbox.checked = false;
      });
      
      updateMessagePreview();
      addNotification('پاک کردن انتخاب', 'انتخاب کاربران پاک شد', 'info');
    }

    // بروزرسانی پیش‌نمایش پیام
    function updateMessagePreview() {
      const title = document.getElementById('notification-title').value;
      const message = document.getElementById('notification-message').value;
      const preview = document.getElementById('preview-content');
      
      if (!title && !message) {
        preview.innerHTML = 'هیچ اعلانی انتخاب نشده';
        return;
      }
      
      const typeIcon = {
        'info': 'ℹ️',
        'success': '✅',
        'warning': '⚠️',
        'promotion': '🎉'
      }[selectedNotificationType] || 'ℹ️';
      
      const typeColor = {
        'info': '#3498db',
        'success': '#27ae60',
        'warning': '#f39c12',
        'promotion': '#e74c3c'
      }[selectedNotificationType] || '#3498db';
      
      preview.innerHTML = `
        <div style="background: ${typeColor}; color: white; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
          <div style="font-weight: 600;">${typeIcon} ${title || 'عنوان اعلان'}</div>
          <div style="margin-top: 5px;">${message || 'متن اعلان'}</div>
        </div>
        <div style="font-size: 12px; color: #666;">
          گیرندگان: ${selectedUsers.length} کاربر
        </div>
      `;
    }

    // ارسال اعلان
    function sendNotification() {
      const title = document.getElementById('notification-title').value;
      const message = document.getElementById('notification-message').value;
      
      if (!title || !message) {
        alert('لطفاً عنوان و متن اعلان را وارد کنید');
        return;
      }
      
      if (selectedUsers.length === 0) {
        alert('لطفاً حداقل یک کاربر را انتخاب کنید');
        return;
      }
      
      const notification = {
        id: Date.now(),
        type: selectedNotificationType,
        title: title,
        message: message,
        recipients: selectedUsers,
        timestamp: new Date().toISOString(),
        showImmediately: document.getElementById('show-immediately').checked,
        showOnce: document.getElementById('show-once').checked,
        persistent: document.getElementById('persistent-notification').checked
      };
      
      // ذخیره اعلان
      userNotifications.unshift(notification);
      localStorage.setItem('userNotifications', JSON.stringify(userNotifications));
      
      // ذخیره اعلان برای هر کاربر
      selectedUsers.forEach(userEmail => {
        const userNotificationsKey = `userNotifications_${userEmail}`;
        const userNotifs = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];
        userNotifs.push(notification);
        localStorage.setItem(userNotificationsKey, JSON.stringify(userNotifs));
      });
      
      // پاک کردن فرم
      document.getElementById('notification-title').value = '';
      document.getElementById('notification-message').value = '';
      clearUserSelection();
      
      addNotification('ارسال اعلان', `اعلان به ${selectedUsers.length} کاربر ارسال شد`, 'success');
      loadNotificationHistory();
    }

    // زمان‌بندی اعلان
    function scheduleNotification() {
      const title = document.getElementById('notification-title').value;
      const message = document.getElementById('notification-message').value;
      
      if (!title || !message) {
        alert('لطفاً عنوان و متن اعلان را وارد کنید');
        return;
      }
      
      if (selectedUsers.length === 0) {
        alert('لطفاً حداقل یک کاربر را انتخاب کنید');
        return;
      }
      
      const scheduleTime = prompt('زمان ارسال را وارد کنید (مثال: 2024-01-15 14:30):');
      if (!scheduleTime) return;
      
      const scheduledNotification = {
        id: Date.now(),
        type: selectedNotificationType,
        title: title,
        message: message,
        recipients: selectedUsers,
        scheduleTime: scheduleTime,
        timestamp: new Date().toISOString(),
        showImmediately: document.getElementById('show-immediately').checked,
        showOnce: document.getElementById('show-once').checked,
        persistent: document.getElementById('persistent-notification').checked
      };
      
      scheduledNotifications.push(scheduledNotification);
      localStorage.setItem('scheduledNotifications', JSON.stringify(scheduledNotifications));
      
      addNotification('زمان‌بندی اعلان', 'اعلان زمان‌بندی شد', 'success');
      loadScheduledNotifications();
    }

    // ذخیره قالب اعلان
    function saveNotificationTemplate() {
      const title = document.getElementById('notification-title').value;
      const message = document.getElementById('notification-message').value;
      
      if (!title || !message) {
        alert('لطفاً عنوان و متن اعلان را وارد کنید');
        return;
      }
      
      const templateName = prompt('نام قالب را وارد کنید:');
      if (!templateName) return;
      
      const templates = JSON.parse(localStorage.getItem('notificationTemplates')) || [];
      templates.push({
        name: templateName,
        type: selectedNotificationType,
        title: title,
        message: message
      });
      
      localStorage.setItem('notificationTemplates', JSON.stringify(templates));
      addNotification('ذخیره قالب', 'قالب اعلان ذخیره شد', 'success');
    }

    // بارگذاری تاریخچه اعلان‌ها
    function loadNotificationHistory() {
      const container = document.getElementById('notification-history-list');
      
      if (userNotifications.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666;">هیچ اعلانی ارسال نشده</p>';
        return;
      }
      
      container.innerHTML = userNotifications.slice(0, 10).map(notification => `
        <div class="history-item">
          <div class="history-time">${new Date(notification.timestamp).toLocaleString('fa-IR')}</div>
          <div class="history-message">${notification.title}</div>
          <div class="history-recipients">${notification.recipients.length} کاربر</div>
        </div>
      `).join('');
    }

    // بارگذاری اعلان‌های زمان‌بندی شده
    function loadScheduledNotifications() {
      const container = document.getElementById('scheduled-notifications-list');
      
      if (scheduledNotifications.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666;">هیچ اعلان زمان‌بندی شده‌ای موجود نیست</p>';
        return;
      }
      
      container.innerHTML = scheduledNotifications.map(notification => `
        <div class="schedule-item">
          <div class="schedule-time">${notification.scheduleTime}</div>
          <div class="schedule-message">${notification.title}</div>
          <div class="schedule-recipients">${notification.recipients.length} کاربر</div>
          <button class="btn btn-danger" onclick="cancelScheduledNotification(${notification.id})" style="font-size: 12px;">لغو</button>
        </div>
      `).join('');
    }

    // لغو اعلان زمان‌بندی شده
    function cancelScheduledNotification(id) {
      if (!confirm('آیا از لغو این اعلان اطمینان دارید؟')) return;
      
      scheduledNotifications = scheduledNotifications.filter(n => n.id !== id);
      localStorage.setItem('scheduledNotifications', JSON.stringify(scheduledNotifications));
      
      loadScheduledNotifications();
      addNotification('لغو اعلان', 'اعلان زمان‌بندی شده لغو شد', 'warning');
    }

    // ===== تنظیمات پیشرفته =====
    
    // نمایش بخش تنظیمات پیشرفته
    function showAdvancedSettings() {
      hideAllSections();
      document.getElementById('advanced-settings-section').style.display = 'block';
      loadAdvancedSettings();
      addNotification('تنظیمات پیشرفته', 'بخش تنظیمات پیشرفته باز شد', 'info');
    }

    // انتخاب رنگ
    function selectColor(color, element) {
      document.querySelectorAll('.color-option').forEach(el => {
        el.classList.remove('selected');
      });
      element.classList.add('selected');
      
      // اعمال رنگ به سایت
      document.documentElement.style.setProperty('--primary-color', color);
    }

    // انتخاب فونت
    function selectFont(font, element) {
      document.querySelectorAll('.font-option').forEach(el => {
        el.classList.remove('selected');
      });
      element.classList.add('selected');
      
      // اعمال فونت به سایت
      document.body.style.fontFamily = font === 'default' ? 'inherit' : font;
    }

    // ذخیره تنظیمات ظاهری
    function saveAppearanceSettings() {
      const selectedColor = document.querySelector('.color-option.selected').style.background;
      const selectedFont = document.querySelector('.font-option.selected').textContent;
      const fontSize = document.getElementById('site-font-size').value;
      
      const appearanceSettings = {
        color: selectedColor,
        font: selectedFont,
        fontSize: fontSize
      };
      
      localStorage.setItem('appearanceSettings', JSON.stringify(appearanceSettings));
      addNotification('تنظیمات ظاهری', 'تنظیمات ظاهری ذخیره شد', 'success');
    }

    // ذخیره تنظیمات عملکرد
    function savePerformanceSettings() {
      const performanceMode = document.getElementById('performance-mode').value;
      const enableCache = document.getElementById('enable-cache').checked;
      const enableCompression = document.getElementById('enable-compression').checked;
      const enableLazyLoading = document.getElementById('enable-lazy-loading').checked;
      const maxRequests = document.getElementById('max-requests').value;
      const timeout = document.getElementById('timeout').value;
      
      const performanceSettings = {
        mode: performanceMode,
        cache: enableCache,
        compression: enableCompression,
        lazyLoading: enableLazyLoading,
        maxRequests: maxRequests,
        timeout: timeout
      };
      
      localStorage.setItem('performanceSettings', JSON.stringify(performanceSettings));
      addNotification('تنظیمات عملکرد', 'تنظیمات عملکرد ذخیره شد', 'success');
    }

    // ذخیره تنظیمات امنیت
    function saveSecuritySettings() {
      const securityLevel = document.getElementById('security-level').value;
      const enableCaptcha = document.getElementById('enable-captcha').checked;
      const enableRateLimiting = document.getElementById('enable-rate-limiting').checked;
      const enableSSL = document.getElementById('enable-ssl').checked;
      const enable2FA = document.getElementById('enable-2fa').checked;
      
      const securitySettings = {
        level: securityLevel,
        captcha: enableCaptcha,
        rateLimiting: enableRateLimiting,
        ssl: enableSSL,
        twoFactor: enable2FA
      };
      
      localStorage.setItem('securitySettings', JSON.stringify(securitySettings));
      addNotification('تنظیمات امنیت', 'تنظیمات امنیت ذخیره شد', 'success');
    }

    // بارگذاری تنظیمات پیشرفته
    function loadAdvancedSettings() {
      const appearanceSettings = JSON.parse(localStorage.getItem('appearanceSettings')) || {};
      const performanceSettings = JSON.parse(localStorage.getItem('performanceSettings')) || {};
      const securitySettings = JSON.parse(localStorage.getItem('securitySettings')) || {};
      
      // اعمال تنظیمات ظاهری
      if (appearanceSettings.color) {
        document.documentElement.style.setProperty('--primary-color', appearanceSettings.color);
      }
      
      if (appearanceSettings.font) {
        document.body.style.fontFamily = appearanceSettings.font;
      }
      
      if (appearanceSettings.fontSize) {
        document.getElementById('site-font-size').value = appearanceSettings.fontSize;
      }
      
      // اعمال تنظیمات عملکرد
      if (performanceSettings.mode) {
        document.getElementById('performance-mode').value = performanceSettings.mode;
      }
      
      if (performanceSettings.cache !== undefined) {
        document.getElementById('enable-cache').checked = performanceSettings.cache;
      }
      
      if (performanceSettings.compression !== undefined) {
        document.getElementById('enable-compression').checked = performanceSettings.compression;
      }
      
      if (performanceSettings.lazyLoading !== undefined) {
        document.getElementById('enable-lazy-loading').checked = performanceSettings.lazyLoading;
      }
      
      if (performanceSettings.maxRequests) {
        document.getElementById('max-requests').value = performanceSettings.maxRequests;
      }
      
      if (performanceSettings.timeout) {
        document.getElementById('timeout').value = performanceSettings.timeout;
      }
      
      // اعمال تنظیمات امنیت
      if (securitySettings.level) {
        document.getElementById('security-level').value = securitySettings.level;
      }
      
      if (securitySettings.captcha !== undefined) {
        document.getElementById('enable-captcha').checked = securitySettings.captcha;
      }
      
      if (securitySettings.rateLimiting !== undefined) {
        document.getElementById('enable-rate-limiting').checked = securitySettings.rateLimiting;
      }
      
      if (securitySettings.ssl !== undefined) {
        document.getElementById('enable-ssl').checked = securitySettings.ssl;
      }
      
      if (securitySettings.twoFactor !== undefined) {
        document.getElementById('enable-2fa').checked = securitySettings.twoFactor;
      }
    }

    // بروزرسانی آمار عملکرد
    function refreshPerformanceMetrics() {
      // شبیه‌سازی آمار عملکرد
      const metrics = {
        loadTime: (Math.random() * 3 + 1).toFixed(1),
        memoryUsage: Math.floor(Math.random() * 50 + 20),
        concurrentRequests: Math.floor(Math.random() * 20 + 5)
      };
      
      // بروزرسانی نمایش
      const performanceElements = document.querySelectorAll('.performance-metric');
      if (performanceElements.length >= 3) {
        performanceElements[0].querySelector('span:last-child').textContent = `${metrics.loadTime}s`;
        performanceElements[0].querySelector('.metric-fill').style.width = `${(metrics.loadTime / 4) * 100}%`;
        
        performanceElements[1].querySelector('span:last-child').textContent = `${metrics.memoryUsage}%`;
        performanceElements[1].querySelector('.metric-fill').style.width = `${metrics.memoryUsage}%`;
        
        performanceElements[2].querySelector('span:last-child').textContent = metrics.concurrentRequests;
        performanceElements[2].querySelector('.metric-fill').style.width = `${(metrics.concurrentRequests / 30) * 100}%`;
      }
      
      addNotification('بروزرسانی آمار', 'آمار عملکرد بروزرسانی شد', 'success');
    }

    // تغییر وضعیت قوانین خودکار
    function toggleRule(ruleType) {
      const ruleElements = document.querySelectorAll('.rule-item');
      let targetRule;
      
      switch(ruleType) {
        case 'backup':
          targetRule = ruleElements[0];
          break;
        case 'stock':
          targetRule = ruleElements[1];
          break;
        case 'cleanup':
          targetRule = ruleElements[2];
          break;
      }
      
      if (targetRule) {
        const statusElement = targetRule.querySelector('.rule-status');
        const isActive = statusElement.classList.contains('active');
        
        if (isActive) {
          statusElement.classList.remove('active');
          statusElement.classList.add('inactive');
          statusElement.textContent = 'غیرفعال';
        } else {
          statusElement.classList.remove('inactive');
          statusElement.classList.add('active');
          statusElement.textContent = 'فعال';
        }
        
        addNotification('تغییر وضعیت قانون', `قانون ${ruleType} ${isActive ? 'غیرفعال' : 'فعال'} شد`, 'info');
      }
    }

    // تنظیم یکپارچه‌سازی
    function configureIntegrations() {
      const integrations = [
        { name: 'ایمیل', status: 'connected' },
        { name: 'پیامک', status: 'disconnected' },
        { name: 'تلگرام', status: 'pending' }
      ];
      
      let config = 'تنظیمات یکپارچه‌سازی:\n\n';
      integrations.forEach(integration => {
        config += `${integration.name}: ${integration.status === 'connected' ? '✅ متصل' : integration.status === 'disconnected' ? '❌ قطع' : '⏳ در انتظار'}\n`;
      });
      
      config += '\nبرای تنظیم هر یکپارچه‌سازی، لطفاً با پشتیبانی تماس بگیرید.';
      
      alert(config);
      addNotification('تنظیم یکپارچه‌سازی', 'تنظیمات یکپارچه‌سازی نمایش داده شد', 'info');
    }

    // اضافه کردن event listeners برای بروزرسانی پیش‌نمایش
    document.addEventListener('DOMContentLoaded', function() {
      const titleInput = document.getElementById('notification-title');
      const messageInput = document.getElementById('notification-message');
      
      if (titleInput) {
        titleInput.addEventListener('input', updateMessagePreview);
      }
      
      if (messageInput) {
        messageInput.addEventListener('input', updateMessagePreview);
      }
    });

    // بررسی اعلان‌های زمان‌بندی شده
    setInterval(() => {
      const now = new Date();
      scheduledNotifications.forEach((notification, index) => {
        const scheduleTime = new Date(notification.scheduleTime);
        if (now >= scheduleTime) {
          // ارسال اعلان
          sendScheduledNotification(notification);
          // حذف از لیست زمان‌بندی شده
          scheduledNotifications.splice(index, 1);
          localStorage.setItem('scheduledNotifications', JSON.stringify(scheduledNotifications));
        }
      });
    }, 60000); // هر دقیقه بررسی کن

    // ارسال اعلان زمان‌بندی شده
    function sendScheduledNotification(notification) {
      // ذخیره اعلان برای هر کاربر
      notification.recipients.forEach(userEmail => {
        const userNotificationsKey = `userNotifications_${userEmail}`;
        const userNotifs = JSON.parse(localStorage.getItem(userNotificationsKey)) || [];
        userNotifs.push(notification);
        localStorage.setItem(userNotificationsKey, JSON.stringify(userNotifs));
      });
      
      addNotification('اعلان زمان‌بندی شده', `اعلان "${notification.title}" ارسال شد`, 'success');
    }
  </script>
</body>
</html>